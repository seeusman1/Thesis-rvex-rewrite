
# Number of contexts in the core.
all: _NUM_CONTEXTS           { 2 }

# Memory map as seen from the debugging interface.
0: MEM                     { 0x00000000 }
0: CREG                    { 0xD0000000 }
0: PLATFORM                { 0xD0000400 }
0: CACHE                   { 0xD0000800 }
0: MMU                     { 0xD0000C00 }
0: _TRACE_ADDR             { 0xD0002000 }

1: MEM                     { 0x00000000 }
1: CREG                    { 0xD0100000 }
1: PLATFORM                { 0xD0100400 }
1: CACHE                   { 0xD0100800 }
1: MMU                     { 0xD0100C00 }
1: _TRACE_ADDR             { 0xD0102000 }

# Flushes the cache.
all: FLUSH_CACHE {
  write(CACHE + 0x00, 0xF);
  write(CACHE + 0x04, 0xF);
}

# This is evaluated when "rvd reset" is called.
all:_RESET {
  write(DCRF, 0x09hh); # break
  FLUSH_CACHE;
  set(reg, 0);
  while (reg < 64, (
    writeWord(CREG_GPREG + (reg*4), 0);
    set(reg, reg + 1);
  ));
  write(DCRF, 0x80hh); # reset
}
