diff -rupN '--exclude=ram.srec' ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/config.vhd work/config.vhd
--- ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/config.vhd	2014-04-16 16:51:31.000000000 +0200
+++ work/config.vhd	2015-11-05 12:40:53.174538421 +0100
@@ -13,6 +13,15 @@
 library techmap;
 use techmap.gencomp.all;
 
+library ieee;
+use ieee.std_logic_1164.all;
+
+library rvex;
+use rvex.common_pkg.all;
+use rvex.core_pkg.all;
+use rvex.cache_pkg.all;
+use rvex.rvsys_grlib_pkg.all;
+
 package config is
 -- Technology and synthesis options
   constant CFG_FABTECH : integer := virtex6;
@@ -21,8 +30,8 @@ package config is
   constant CFG_NOASYNC : integer := 0;
   constant CFG_SCAN : integer := 0;
 -- LEON3 processor core
-  constant CFG_LEON3 : integer := 1;
-  constant CFG_NCPU : integer := (1);
+  constant CFG_LEON3 : integer := 0;
+  constant CFG_NLEON : integer := 0;
   constant CFG_NWIN : integer := (8);
   constant CFG_V8 : integer := 16#32# + 4*0;
   constant CFG_MAC : integer := 0;
@@ -61,7 +70,7 @@ package config is
   constant CFG_TLB_TYPE : integer := 1 + 0*2;
   constant CFG_TLB_REP : integer := 1;
   constant CFG_MMU_PAGE : integer := 0;
-  constant CFG_DSU : integer := 1;
+  constant CFG_DSU : integer := 0;
   constant CFG_ITBSZ : integer := 4;
   constant CFG_ATBSZ : integer := 4;
   constant CFG_LEON3FT_EN : integer := 0;
@@ -73,6 +82,68 @@ package config is
   constant CFG_LEON3_NETLIST: integer := 0;
   constant CFG_DISAS : integer := 0 + 0;
   constant CFG_PCLOW : integer := 2;
+-- r-VEX processor core
+  constant CFG_RVEX : integer := 1;
+  constant CFG_NRVEX : integer := 3;
+  constant CFG_RVEX_CFG : rvex_grlib_generic_config_array(0 to CFG_NRVEX-1) := (rvex_grlib_cfg(
+    
+    -- Core 0 configuration
+    core => rvex_cfg(
+      numLanesLog2          => 2,
+      numLaneGroupsLog2     => 0,
+      numContextsLog2       => 0,
+      bundleAlignLog2       => 1,
+      limmhFromPreviousPair => 0,
+      traceEnable           => 0
+    ), core_valid => true,
+    
+    -- Cache configuration
+    cache => cache_cfg(
+      instrCacheLinesLog2 => 9, -- 512*32 = 16 kiB per core
+      dataCacheLinesLog2  => 11  -- 2048*4 = 8 kiB per core
+    ), cache_valid => true
+    
+  ), rvex_grlib_cfg(
+    -- Core 1 configuration
+    core => rvex_cfg(
+      numLanesLog2          => 1,
+      numLaneGroupsLog2     => 0,
+      numContextsLog2       => 0,
+      bundleAlignLog2       => 1,
+      limmhFromPreviousPair => 0,
+      traceEnable           => 0
+    ), core_valid => true,
+    
+    -- Cache configuration
+    cache => cache_cfg(
+      instrCacheLinesLog2 => 8, -- 256*32 = 8 kiB per core
+      dataCacheLinesLog2  => 10  -- 1024*4 = 4 kiB per core
+    ), cache_valid => true
+    
+  ), rvex_grlib_cfg(
+    -- Core 2 configuration
+    core => rvex_cfg(
+      numLanesLog2          => 1,
+      numLaneGroupsLog2     => 0,
+      numContextsLog2       => 0,
+      bundleAlignLog2       => 1,
+      limmhFromPreviousPair => 0,
+      traceEnable           => 0
+    ), core_valid => true,
+    
+    -- Cache configuration
+    cache => cache_cfg(
+      instrCacheLinesLog2 => 8, -- 256*32 = 8 kiB per core
+      dataCacheLinesLog2  => 10  -- 1024*4 = 4 kiB per core
+    ), cache_valid => true
+    ));
+
+-- r-VEX PCIe support
+  constant CFG_AHB_PCIE : integer := 1;
+-- Total number of processors
+  --constant CFG_NCPU : integer := CFG_NLEON + CFG_NRVEX * 2**CFG_RVEX_CFG.core.numLaneGroupsLog2;
+  --Because of the heterogeneity, this constant needs to be set manually if the cores are dynamic. If all cores are static, just use NRVEX
+  constant CFG_NCPU : integer := CFG_NLEON + CFG_NRVEX;
 -- AMBA settings
   constant CFG_DEFMST : integer := (0);
   constant CFG_RROBIN : integer := 1;
@@ -85,7 +156,8 @@ package config is
   constant CFG_AHB_MONWAR : integer := 0;
   constant CFG_AHB_DTRACE : integer := 0;
 -- DSU UART
-  constant CFG_AHB_UART : integer := 0;
+  constant CFG_AHB_UART : integer := 1;
+  constant CFG_AHB_UART_RVEX : integer := 1; -- Use rvex debug UART instead of grlib UART
 -- JTAG based DSU interface
   constant CFG_AHB_JTAG : integer := 1;
 -- Ethernet DSU
@@ -96,7 +168,7 @@ package config is
   constant CFG_ETH_ENM : integer := 16#020789#;
   constant CFG_ETH_ENL : integer := 16#000123#;
 -- LEON2 memory controller
-  constant CFG_MCTRL_LEON2 : integer := 1;
+  constant CFG_MCTRL_LEON2 : integer := 0;
   constant CFG_MCTRL_RAM8BIT : integer := 1;
   constant CFG_MCTRL_RAM16BIT : integer := 1;
   constant CFG_MCTRL_5CS : integer := 0;
@@ -123,7 +195,7 @@ package config is
   constant CFG_GRETH_FT : integer := 0;
   constant CFG_GRETH_EDCLFT : integer := 0;
 -- UART 1
-  constant CFG_UART1_ENABLE : integer := 1;
+  constant CFG_UART1_ENABLE : integer := 0;
   constant CFG_UART1_FIFO : integer := 8;
 -- LEON3 interrupt controller
   constant CFG_IRQ3_ENABLE : integer := 1;
@@ -158,10 +230,10 @@ package config is
  constant CFG_PCIE_SIM_MAS : integer := 0;
  constant CFG_PCIEXPVID : integer := 16#0#;
  constant CFG_PCIEXPDID : integer := 16#0#;
-  constant CFG_NO_OF_LANES : integer := 1;
+  constant CFG_NO_OF_LANES : integer := 4;
 -- GRLIB debugging
   constant CFG_DUART : integer := 0;
 -- Xilinx MIG DDR2 controller
   constant CFG_MIG_DDR2 : integer := 1;
-  constant CFG_MIG_CLK4 : integer := 16;
+  constant CFG_MIG_CLK4 : integer := 32;
 end;
diff -rupN '--exclude=ram.srec' ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/leon3mp_mig39.ucf work/leon3mp_mig39.ucf
--- ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/leon3mp_mig39.ucf	2014-04-16 16:50:08.000000000 +0200
+++ work/leon3mp_mig39.ucf	2015-11-05 12:40:53.174538421 +0100
@@ -1,160 +1,212 @@
-
-NET "clk_ref_p" TNM_NET = TNM_clk_ref;
-TIMESPEC "TS_clk_ref" = PERIOD "TNM_clk_ref" 5 ns ;
-
-NET "reset" IOSTANDARD = SSTL15;
-NET "reset" LOC = "H10";
-NET "errorn" LOC = "AD24";
-
-NET "address(0)"                      LOC = "AL8";    ## 29 on U4, A1 on U27
-NET "address(1)"                      LOC = "AK8";    ## 25 on U4, B1 on U27
-NET "address(2)"                      LOC = "AC9";    ## 24 on U4, C1 on U27
-NET "address(3)"                      LOC = "AD10";   ## 23 on U4, D1 on U27
-NET "address(4)"                      LOC = "C8";     ## 22 on U4, D2 on U27
-NET "address(5)"                      LOC = "B8";     ## 21 on U4, A2 on U27
-NET "address(6)"                      LOC = "E9";     ## 20 on U4, C2 on U27
-NET "address(7)"                      LOC = "E8";     ## 19 on U4, A3 on U27
-NET "address(8)"                      LOC = "A8";     ## 8  on U4, B3 on U27
-NET "address(9)"                      LOC = "A9";     ## 7  on U4, C3 on U27
-NET "address(10)"                     LOC = "D9";     ## 6  on U4, D3 on U27
-NET "address(11)"                     LOC = "C9";     ## 5  on U4, C4 on U27
-NET "address(12)"                     LOC = "D10";    ## 4  on U4, A5 on U27
-NET "address(13)"                     LOC = "C10";    ## 3  on U4, B5 on U27
-NET "address(14)"                     LOC = "F10";    ## 2  on U4, C5 on U27
-NET "address(15)"                     LOC = "F9";     ## 1  on U4, D7 on U27
-NET "address(16)"                     LOC = "AH8";    ## 55 on U4, D8 on U27
-NET "address(17)"                     LOC = "AG8";    ## 18 on U4, A7 on U27
-NET "address(18)"                     LOC = "AP9";    ## 17 on U4, B7 on U27
-NET "address(19)"                     LOC = "AN9";    ## 16 on U4, C7 on U27
-NET "address(20)"                     LOC = "AF10";   ## 11 on U4, C8 on U27
-NET "address(21)"                     LOC = "AF9";    ## 10 on U4, A8 on U27
-NET "address(22)"                     LOC = "AL9";    ## 9  on U4, G1 on U27
-NET "address(23)"                     LOC = "AA23";   ## 26 on U4
-NET "data(0)"                      LOC = "AF24";   ## 34 on U4, F2 on U27
-NET "data(1)"                      LOC = "AF25";   ## 36 on U4, E2 on U27
-NET "data(2)"                      LOC = "W24";    ## 39 on U4, G3 on U27
-NET "data(3)"                      LOC = "V24";    ## 41 on U4, E4 on U27
-NET "data(4)"                      LOC = "H24";    ## 47 on U4, E5 on U27
-NET "data(5)"                      LOC = "H25";    ## 49 on U4, G5 on U27
-NET "data(6)"                      LOC = "P24";    ## 51 on U4, G6 on U27
-NET "data(7)"                      LOC = "R24";    ## 53 on U4, H7 on U27
-NET "data(8)"                      LOC = "G23";    ## 35 on U4, E1 on U27
-NET "data(9)"                      LOC = "H23";    ## 37 on U4, E3 on U27
-NET "data(10)"                     LOC = "N24";    ## 40 on U4, F3 on U27
-NET "data(11)"                     LOC = "N23";    ## 42 on U4, F4 on U27
-NET "data(12)"                     LOC = "F23";    ## 48 on U4, F5 on U27
-NET "data(13)"                     LOC = "F24";    ## 50 on U4, H5 on U27
-NET "data(14)"                     LOC = "L24";    ## 52 on U4, G7 on U27
-NET "data(15)"                     LOC = "M23";    ## 54 on U4, E7 on U27
-#NET "FLASH_WAIT"                    LOC = "J26";    ## 56 on U4
-NET "writen"                    LOC = "AF23";   ## 14 on U4, G8 on U27
-NET "oen"                    LOC = "AA24";   ## 32 on U4, F8 on U27
-#NET "FPGA_CCLK"                     LOC = "K8";     ##           F1 on U27
-NET "alatch"                 LOC = "AC23";   ##           H1 on U27
-NET "romsn"                    LOC = "Y24";    ## 30 on U4, B4 on U27 (U10 and switch S2.2 setting select either U4 or U27)
-##
-
-NET "erx_col"                       LOC = "AK13";   ## 114 on U80
-NET "erx_crs"                       LOC = "AL13";   ## 115 on U80
-NET "emdint"                       LOC = "AH14";   ## 32  on U80
-NET "emdc"                       LOC = "AP14";   ## 35  on U80
-NET "emdio"                      LOC = "AN14";   ## 33  on U80
-NET "erstn"                     LOC = "AH13";   ## 36  on U80
-NET "erx_clk"                     LOC = "AP11";   ## 7   on U80
-NET "erx_dv"                LOC = "AM13";   ## 4   on U80
-NET "erxd(0)"                      LOC = "AN13";   ## 3   on U80
-NET "erxd(1)"                      LOC = "AF14";   ## 128 on U80
-NET "erxd(2)"                      LOC = "AE14";   ## 126 on U80
-NET "erxd(3)"                      LOC = "AN12";   ## 125 on U80
-NET "erxd(4)"                      LOC = "AM12";   ## 124 on U80
-NET "erxd(5)"                      LOC = "AD11";   ## 123 on U80
-NET "erxd(6)"                      LOC = "AC12";   ## 121 on U80
-NET "erxd(7)"                      LOC = "AC13";   ## 120 on U80
-NET "erx_er"                      LOC = "AG12";   ## 9   on U80
-NET "etx_clk"                     LOC = "AD12";   ## 10  on U80
-NET "etx_en"                LOC = "AJ10";   ## 16  on U80
-NET "egtx_clk"                LOC = "AH12";   ## 14  on U80
-NET "etxd(0)"                      LOC = "AM11";   ## 18  on U80
-NET "etxd(1)"                      LOC = "AL11";   ## 19  on U80
-NET "etxd(2)"                      LOC = "AG10";   ## 20  on U80
-NET "etxd(3)"                      LOC = "AG11";   ## 24  on U80
-NET "etxd(4)"                      LOC = "AL10";   ## 25  on U80
-NET "etxd(5)"                      LOC = "AM10";   ## 26  on U80
-NET "etxd(6)"                      LOC = "AE11";   ## 28  on U80
-NET "etxd(7)"                      LOC = "AF11";   ## 29  on U80
-NET "etx_er"                      LOC = "AH10";   ## 13  on U80
-
-NET "dsurx"                      LOC = "J24";    ## 24  on U34
-NET "dsutx"                      LOC = "J25";    ## 25  on U34
-
-#NET "GPIO_DIP_SW1"                  LOC = "D22";    ## 1   on SW1 DIP switch (active-high)
-#NET "GPIO_DIP_SW2"                  LOC = "C22";    ## 2   on SW1 DIP switch (active-high)
-#NET "GPIO_DIP_SW3"                  LOC = "L21";    ## 3   on SW1 DIP switch (active-high)
-#NET "GPIO_DIP_SW4"                  LOC = "L20";    ## 4   on SW1 DIP switch (active-high)
-#NET "GPIO_DIP_SW5"                  LOC = "C18";    ## 5   on SW1 DIP switch (active-high)
-NET "dsubre"                  LOC = "B18";    ## 6   on SW1 DIP switch (active-high)
-#NET "GPIO_DIP_SW7"                  LOC = "K22";    ## 7   on SW1 DIP switch (active-high)
-#NET "GPIO_DIP_SW8"                  LOC = "K21";    ## 8   on SW1 DIP switch (active-high)
-##
-
-NET "led(0)"                    LOC = "AC22";   ## 2   on LED DS12, 1 on J62
-NET "led(1)"                    LOC = "AC24";   ## 2   on LED DS11, 2 on J62
-NET "led(2)"                    LOC = "AE22";   ## 2   on LED DS9,  3 on J62
-NET "led(3)"                    LOC = "AE23";   ## 2   on LED DS10, 4 on J62
-NET "led(4)"                    LOC = "AB23";   ## 2   on LED DS15, 5 on J62
-NET "led(5)"                    LOC = "AG23";   ## 2   on LED DS14, 6 on J62
-NET "led(6)"                    LOC = "AE24";   ## 2   on LED DS22, 7 on J62
-#NET "led(7)"                    LOC = "AD24";   ## 2   on LED DS21, 8 on J62
-
-NET "dvi_iic_scl"                   LOC = "AN10";   ## 2   on Q5, 15 on U38
-NET "iic_scl_main"               LOC = "AK9";    ## 2   on Q19
-#NET "IIC_SCL_SFP"                   LOC = "AA34";   ## 2   on Q23
-NET "dvi_iic_sda"                   LOC = "AP10";   ## 2   on Q6, 14 on U38
-NET "iic_sda_main"               LOC = "AE9";    ## 2   on Q20
-#NET "IIC_SDA_SFP"                   LOC = "AA33";   ## 2   on Q21
-
-NET "tft_lcd_data(0)"                        LOC = "AJ19";   ## 63 on U38 (thru series R111 47.5 ohm)
-NET "tft_lcd_data(1)"                        LOC = "AH19";   ## 62 on U38 (thru series R110 47.5 ohm)
-NET "tft_lcd_data(2)"                        LOC = "AM17";   ## 61 on U38 (thru series R109 47.5 ohm)
-NET "tft_lcd_data(3)"                        LOC = "AM16";   ## 60 on U38 (thru series R108 47.5 ohm)
-NET "tft_lcd_data(4)"                        LOC = "AD17";   ## 59 on U38 (thru series R107 47.5 ohm)
-NET "tft_lcd_data(5)"                        LOC = "AE17";   ## 58 on U38 (thru series R106 47.5 ohm)
-NET "tft_lcd_data(6)"                        LOC = "AK18";   ## 55 on U38 (thru series R105 47.5 ohm)
-NET "tft_lcd_data(7)"                        LOC = "AK17";   ## 54 on U38 (thru series R104 47.5 ohm)
-NET "tft_lcd_data(8)"                        LOC = "AE18";   ## 53 on U38 (thru series R103 47.5 ohm)
-NET "tft_lcd_data(9)"                        LOC = "AF18";   ## 52 on U38 (thru series R102 47.5 ohm)
-NET "tft_lcd_data(10)"                       LOC = "AL16";   ## 51 on U38 (thru series R101 47.5 ohm)
-NET "tft_lcd_data(11)"                       LOC = "AK16";   ## 50 on U38 (thru series R100 47.5 ohm)
-NET "tft_lcd_de"                        LOC = "AD16";   ## 2  on U38 (thru series R112 47.5 ohm)
-#NET "DVI_GPIO1_FMC_C2M_PG_LS"       LOC = "K9";     ## 18 on U32 (not wired to U38)
-NET "tft_lcd_hsync"                         LOC = "AN17";   ## 4  on U38 (thru series R113 47.5 ohm)
-NET "tft_lcd_reset_b"                LOC = "AP17";   ## 2  on U32 (DVI_RESET_B pin 13 on U38)
-NET "tft_lcd_vsync"                         LOC = "AD15";   ## 5  on U38 (thru series R114 47.5 ohm)
-NET "tft_lcd_clk_n"                    LOC = "AC17";   ## 56 on U38
-NET "tft_lcd_clk_p"                    LOC = "AC18";   ## 57 on U38
-
-#NET "SYSACE_CFGTDI"                 LOC = "AC8";    ## 81  on U19
-NET "sysace_d(0)"                     LOC = "AM15";   ## 66  on U19
-NET "sysace_d(1)"                     LOC = "AJ17";   ## 65  on U19
-NET "sysace_d(2)"                     LOC = "AJ16";   ## 63  on U19
-NET "sysace_d(3)"                     LOC = "AP16";   ## 62  on U19
-NET "sysace_d(4)"                     LOC = "AG16";   ## 61  on U19
-NET "sysace_d(5)"                     LOC = "AH15";   ## 60  on U19
-NET "sysace_d(6)"                     LOC = "AF16";   ## 59  on U19
-NET "sysace_d(7)"                     LOC = "AN15";   ## 58  on U19
-NET "sysace_mpa(0)"                  LOC = "AC15";   ## 70  on U19
-NET "sysace_mpa(1)"                  LOC = "AP15";   ## 69  on U19
-NET "sysace_mpa(2)"                  LOC = "AG17";   ## 68  on U19
-NET "sysace_mpa(3)"                  LOC = "AH17";   ## 67  on U19
-NET "sysace_mpa(4)"                  LOC = "AG15";   ## 45  on U19
-NET "sysace_mpa(5)"                  LOC = "AF15";   ## 44  on U19
-NET "sysace_mpa(6)"                  LOC = "AK14";   ## 43  on U19
-#NET "SYSACE_MPBRDY"                 LOC = "AJ15";   ## 39  on U19
-NET "sysace_mpce"                   LOC = "AJ14";   ## 42  on U19
-NET "sysace_mpirq"                  LOC = "L9";     ## 41  on U19
-NET "sysace_mpoe"                   LOC = "AL15";   ## 77  on U19
-NET "sysace_mpwe"                   LOC = "AL14";   ## 76  on U19
-NET "clk_33"              LOC = "AE16";   ## 93  on U19
+######################################################################################
+## PCI-express signals (copied from reference project)                              ##
+######################################################################################
+#------------------------
+# Clock and Reset Pinout
+#------------------------
+NET "pcie_dma_block.pcie_dma/pcie_ref_clk" TNM_NET = "SYSCLK" ;
+NET "*/pcie_clocking_i/clk_125" TNM_NET = "CLK_125" ;
+NET "*/TxOutClk_bufg" TNM_NET = "TXOUTCLKBUFG";
+
+TIMESPEC "TS_SYSCLK"  = PERIOD "SYSCLK" 250.00 MHz HIGH 50 % ;
+TIMESPEC "TS_CLK_125" = PERIOD "CLK_125" TS_SYSCLK*0.5 HIGH 50 %; # PRIORITY 100 ;
+TIMESPEC "TS_TXOUTCLKBUFG"  = PERIOD "TXOUTCLKBUFG" 250 MHz HIGH 50 %; # PRIORITY 100 ;
+
+NET "sys_reset_n" TIG;
+PIN "*/trn_reset_n_int_i.CLR" TIG ;
+PIN "*/trn_reset_n_i.CLR" TIG ;
+PIN "*/pcie_clocking_i/mmcm_adv_i.RST" TIG ;
+
+#TIMESPEC "TS_TRNLNKUPN" = FROM FFS(*) TO FFS(trn_lnk_up_n_int_i) 4 ns;
+#TIMESPEC "TS_RESETN" = FROM FFS(*) TO FFS(trn_reset_n_i) 4 ns;
+TIMESPEC "TS_RESETN" = FROM FFS(*) TO FFS("pcie_dma_block.pcie_dma/user_reset") 8 ns;
+
+
+#-----------------------------------
+# PCIe Transceiver & Core Locations
+#-----------------------------------
+
+# PCIe Block Placement
+INST "*/pcie_2_0_i/pcie_block_i" LOC = PCIE_X0Y1;
+
+INST "*/pcie_2_0_i/pcie_gt_i/gtx_v6_i/no_of_lanes.GTXD[0].GTX" LOC = GTXE1_X0Y15;
+INST "*/pcie_2_0_i/pcie_gt_i/gtx_v6_i/no_of_lanes.GTXD[1].GTX" LOC = GTXE1_X0Y14;
+INST "*/pcie_2_0_i/pcie_gt_i/gtx_v6_i/no_of_lanes.GTXD[2].GTX" LOC = GTXE1_X0Y13;
+INST "*/pcie_2_0_i/pcie_gt_i/gtx_v6_i/no_of_lanes.GTXD[3].GTX" LOC = GTXE1_X0Y12;
+
+#------------------------
+# Clock and Reset Pinout
+#------------------------
+
+NET  sys_reset_n           LOC  = AE13 | IOSTANDARD = LVCMOS25 | NODELAY;
+
+# 250 MHz Reference Clock
+INST "pcie_dma_block.pcie_dma/pcie_refclk_ibuf" LOC = IBUFDS_GTXE1_X0Y4; # Implies pinout
+
+# MMCM Placment. This constraint selects the MMCM Placement
+INST "*/pcie_clocking_i/mmcm_adv_i" LOC = MMCM_ADV_X0Y7;
+
+######################################################################################
+## Other definitions                                                                ##
+######################################################################################
+
+
+NET "clk_ref_p" TNM_NET = TNM_clk_ref;
+TIMESPEC "TS_clk_ref" = PERIOD "TNM_clk_ref" 5 ns ;
+
+NET "reset" IOSTANDARD = SSTL15;
+NET "reset" LOC = "H10";
+#NET "errorn" LOC = "AD24";
+
+NET "address(0)"                      LOC = "AL8";    ## 29 on U4, A1 on U27
+NET "address(1)"                      LOC = "AK8";    ## 25 on U4, B1 on U27
+NET "address(2)"                      LOC = "AC9";    ## 24 on U4, C1 on U27
+NET "address(3)"                      LOC = "AD10";   ## 23 on U4, D1 on U27
+NET "address(4)"                      LOC = "C8";     ## 22 on U4, D2 on U27
+NET "address(5)"                      LOC = "B8";     ## 21 on U4, A2 on U27
+NET "address(6)"                      LOC = "E9";     ## 20 on U4, C2 on U27
+NET "address(7)"                      LOC = "E8";     ## 19 on U4, A3 on U27
+NET "address(8)"                      LOC = "A8";     ## 8  on U4, B3 on U27
+NET "address(9)"                      LOC = "A9";     ## 7  on U4, C3 on U27
+NET "address(10)"                     LOC = "D9";     ## 6  on U4, D3 on U27
+NET "address(11)"                     LOC = "C9";     ## 5  on U4, C4 on U27
+NET "address(12)"                     LOC = "D10";    ## 4  on U4, A5 on U27
+NET "address(13)"                     LOC = "C10";    ## 3  on U4, B5 on U27
+NET "address(14)"                     LOC = "F10";    ## 2  on U4, C5 on U27
+NET "address(15)"                     LOC = "F9";     ## 1  on U4, D7 on U27
+NET "address(16)"                     LOC = "AH8";    ## 55 on U4, D8 on U27
+NET "address(17)"                     LOC = "AG8";    ## 18 on U4, A7 on U27
+NET "address(18)"                     LOC = "AP9";    ## 17 on U4, B7 on U27
+NET "address(19)"                     LOC = "AN9";    ## 16 on U4, C7 on U27
+NET "address(20)"                     LOC = "AF10";   ## 11 on U4, C8 on U27
+NET "address(21)"                     LOC = "AF9";    ## 10 on U4, A8 on U27
+NET "address(22)"                     LOC = "AL9";    ## 9  on U4, G1 on U27
+NET "address(23)"                     LOC = "AA23";   ## 26 on U4
+NET "data(0)"                      LOC = "AF24";   ## 34 on U4, F2 on U27
+NET "data(1)"                      LOC = "AF25";   ## 36 on U4, E2 on U27
+NET "data(2)"                      LOC = "W24";    ## 39 on U4, G3 on U27
+NET "data(3)"                      LOC = "V24";    ## 41 on U4, E4 on U27
+NET "data(4)"                      LOC = "H24";    ## 47 on U4, E5 on U27
+NET "data(5)"                      LOC = "H25";    ## 49 on U4, G5 on U27
+NET "data(6)"                      LOC = "P24";    ## 51 on U4, G6 on U27
+NET "data(7)"                      LOC = "R24";    ## 53 on U4, H7 on U27
+NET "data(8)"                      LOC = "G23";    ## 35 on U4, E1 on U27
+NET "data(9)"                      LOC = "H23";    ## 37 on U4, E3 on U27
+NET "data(10)"                     LOC = "N24";    ## 40 on U4, F3 on U27
+NET "data(11)"                     LOC = "N23";    ## 42 on U4, F4 on U27
+NET "data(12)"                     LOC = "F23";    ## 48 on U4, F5 on U27
+NET "data(13)"                     LOC = "F24";    ## 50 on U4, H5 on U27
+NET "data(14)"                     LOC = "L24";    ## 52 on U4, G7 on U27
+NET "data(15)"                     LOC = "M23";    ## 54 on U4, E7 on U27
+#NET "FLASH_WAIT"                    LOC = "J26";    ## 56 on U4
+NET "writen"                    LOC = "AF23";   ## 14 on U4, G8 on U27
+NET "oen"                    LOC = "AA24";   ## 32 on U4, F8 on U27
+#NET "FPGA_CCLK"                     LOC = "K8";     ##           F1 on U27
+NET "alatch"                 LOC = "AC23";   ##           H1 on U27
+NET "romsn"                    LOC = "Y24";    ## 30 on U4, B4 on U27 (U10 and switch S2.2 setting select either U4 or U27)
+##
+
+NET "erx_col"                       LOC = "AK13";   ## 114 on U80
+NET "erx_crs"                       LOC = "AL13";   ## 115 on U80
+NET "emdint"                       LOC = "AH14";   ## 32  on U80
+NET "emdc"                       LOC = "AP14";   ## 35  on U80
+NET "emdio"                      LOC = "AN14";   ## 33  on U80
+NET "erstn"                     LOC = "AH13";   ## 36  on U80
+NET "erx_clk"                     LOC = "AP11";   ## 7   on U80
+NET "erx_dv"                LOC = "AM13";   ## 4   on U80
+NET "erxd(0)"                      LOC = "AN13";   ## 3   on U80
+NET "erxd(1)"                      LOC = "AF14";   ## 128 on U80
+NET "erxd(2)"                      LOC = "AE14";   ## 126 on U80
+NET "erxd(3)"                      LOC = "AN12";   ## 125 on U80
+NET "erxd(4)"                      LOC = "AM12";   ## 124 on U80
+NET "erxd(5)"                      LOC = "AD11";   ## 123 on U80
+NET "erxd(6)"                      LOC = "AC12";   ## 121 on U80
+NET "erxd(7)"                      LOC = "AC13";   ## 120 on U80
+NET "erx_er"                      LOC = "AG12";   ## 9   on U80
+NET "etx_clk"                     LOC = "AD12";   ## 10  on U80
+NET "etx_en"                LOC = "AJ10";   ## 16  on U80
+NET "egtx_clk"                LOC = "AH12";   ## 14  on U80
+NET "etxd(0)"                      LOC = "AM11";   ## 18  on U80
+NET "etxd(1)"                      LOC = "AL11";   ## 19  on U80
+NET "etxd(2)"                      LOC = "AG10";   ## 20  on U80
+NET "etxd(3)"                      LOC = "AG11";   ## 24  on U80
+NET "etxd(4)"                      LOC = "AL10";   ## 25  on U80
+NET "etxd(5)"                      LOC = "AM10";   ## 26  on U80
+NET "etxd(6)"                      LOC = "AE11";   ## 28  on U80
+NET "etxd(7)"                      LOC = "AF11";   ## 29  on U80
+NET "etx_er"                      LOC = "AH10";   ## 13  on U80
+
+NET "dsurx"                      LOC = "J24";    ## 24  on U34
+NET "dsutx"                      LOC = "J25";    ## 25  on U34
+
+#NET "GPIO_DIP_SW1"                  LOC = "D22";    ## 1   on SW1 DIP switch (active-high)
+#NET "GPIO_DIP_SW2"                  LOC = "C22";    ## 2   on SW1 DIP switch (active-high)
+#NET "GPIO_DIP_SW3"                  LOC = "L21";    ## 3   on SW1 DIP switch (active-high)
+#NET "GPIO_DIP_SW4"                  LOC = "L20";    ## 4   on SW1 DIP switch (active-high)
+#NET "GPIO_DIP_SW5"                  LOC = "C18";    ## 5   on SW1 DIP switch (active-high)
+NET "dsubre"                  LOC = "B18";    ## 6   on SW1 DIP switch (active-high)
+#NET "GPIO_DIP_SW7"                  LOC = "K22";    ## 7   on SW1 DIP switch (active-high)
+#NET "GPIO_DIP_SW8"                  LOC = "K21";    ## 8   on SW1 DIP switch (active-high)
+##
+
+NET "led(0)"                    LOC = "AC22";   ## 2   on LED DS12, 1 on J62
+NET "led(1)"                    LOC = "AC24";   ## 2   on LED DS11, 2 on J62
+NET "led(2)"                    LOC = "AE22";   ## 2   on LED DS9,  3 on J62
+NET "led(3)"                    LOC = "AE23";   ## 2   on LED DS10, 4 on J62
+NET "led(4)"                    LOC = "AB23";   ## 2   on LED DS15, 5 on J62
+NET "led(5)"                    LOC = "AG23";   ## 2   on LED DS14, 6 on J62
+NET "led(6)"                    LOC = "AE24";   ## 2   on LED DS22, 7 on J62
+NET "led(7)"                    LOC = "AD24";   ## 2   on LED DS21, 8 on J62
+
+NET "dvi_iic_scl"                   LOC = "AN10";   ## 2   on Q5, 15 on U38
+NET "iic_scl_main"               LOC = "AK9";    ## 2   on Q19
+#NET "IIC_SCL_SFP"                   LOC = "AA34";   ## 2   on Q23
+NET "dvi_iic_sda"                   LOC = "AP10";   ## 2   on Q6, 14 on U38
+NET "iic_sda_main"               LOC = "AE9";    ## 2   on Q20
+#NET "IIC_SDA_SFP"                   LOC = "AA33";   ## 2   on Q21
+
+NET "tft_lcd_data(0)"                        LOC = "AJ19";   ## 63 on U38 (thru series R111 47.5 ohm)
+NET "tft_lcd_data(1)"                        LOC = "AH19";   ## 62 on U38 (thru series R110 47.5 ohm)
+NET "tft_lcd_data(2)"                        LOC = "AM17";   ## 61 on U38 (thru series R109 47.5 ohm)
+NET "tft_lcd_data(3)"                        LOC = "AM16";   ## 60 on U38 (thru series R108 47.5 ohm)
+NET "tft_lcd_data(4)"                        LOC = "AD17";   ## 59 on U38 (thru series R107 47.5 ohm)
+NET "tft_lcd_data(5)"                        LOC = "AE17";   ## 58 on U38 (thru series R106 47.5 ohm)
+NET "tft_lcd_data(6)"                        LOC = "AK18";   ## 55 on U38 (thru series R105 47.5 ohm)
+NET "tft_lcd_data(7)"                        LOC = "AK17";   ## 54 on U38 (thru series R104 47.5 ohm)
+NET "tft_lcd_data(8)"                        LOC = "AE18";   ## 53 on U38 (thru series R103 47.5 ohm)
+NET "tft_lcd_data(9)"                        LOC = "AF18";   ## 52 on U38 (thru series R102 47.5 ohm)
+NET "tft_lcd_data(10)"                       LOC = "AL16";   ## 51 on U38 (thru series R101 47.5 ohm)
+NET "tft_lcd_data(11)"                       LOC = "AK16";   ## 50 on U38 (thru series R100 47.5 ohm)
+NET "tft_lcd_de"                        LOC = "AD16";   ## 2  on U38 (thru series R112 47.5 ohm)
+#NET "DVI_GPIO1_FMC_C2M_PG_LS"       LOC = "K9";     ## 18 on U32 (not wired to U38)
+NET "tft_lcd_hsync"                         LOC = "AN17";   ## 4  on U38 (thru series R113 47.5 ohm)
+NET "tft_lcd_reset_b"                LOC = "AP17";   ## 2  on U32 (DVI_RESET_B pin 13 on U38)
+NET "tft_lcd_vsync"                         LOC = "AD15";   ## 5  on U38 (thru series R114 47.5 ohm)
+NET "tft_lcd_clk_n"                    LOC = "AC17";   ## 56 on U38
+NET "tft_lcd_clk_p"                    LOC = "AC18";   ## 57 on U38
+
+#NET "SYSACE_CFGTDI"                 LOC = "AC8";    ## 81  on U19
+NET "sysace_d(0)"                     LOC = "AM15";   ## 66  on U19
+NET "sysace_d(1)"                     LOC = "AJ17";   ## 65  on U19
+NET "sysace_d(2)"                     LOC = "AJ16";   ## 63  on U19
+NET "sysace_d(3)"                     LOC = "AP16";   ## 62  on U19
+NET "sysace_d(4)"                     LOC = "AG16";   ## 61  on U19
+NET "sysace_d(5)"                     LOC = "AH15";   ## 60  on U19
+NET "sysace_d(6)"                     LOC = "AF16";   ## 59  on U19
+NET "sysace_d(7)"                     LOC = "AN15";   ## 58  on U19
+NET "sysace_mpa(0)"                  LOC = "AC15";   ## 70  on U19
+NET "sysace_mpa(1)"                  LOC = "AP15";   ## 69  on U19
+NET "sysace_mpa(2)"                  LOC = "AG17";   ## 68  on U19
+NET "sysace_mpa(3)"                  LOC = "AH17";   ## 67  on U19
+NET "sysace_mpa(4)"                  LOC = "AG15";   ## 45  on U19
+NET "sysace_mpa(5)"                  LOC = "AF15";   ## 44  on U19
+NET "sysace_mpa(6)"                  LOC = "AK14";   ## 43  on U19
+#NET "SYSACE_MPBRDY"                 LOC = "AJ15";   ## 39  on U19
+NET "sysace_mpce"                   LOC = "AJ14";   ## 42  on U19
+NET "sysace_mpirq"                  LOC = "L9";     ## 41  on U19
+NET "sysace_mpoe"                   LOC = "AL15";   ## 77  on U19
+NET "sysace_mpwe"                   LOC = "AL14";   ## 76  on U19
+NET "clk_33"              LOC = "AE16";   ## 93  on U19
 NET "clk_33" PERIOD = 30.000 ;
 OFFSET = IN : 20.000 : BEFORE clk_33 ;
 OFFSET = OUT : 20.000 : AFTER clk_33 ;
diff -rupN '--exclude=ram.srec' ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/leon3mp.ucf work/leon3mp.ucf
--- ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/leon3mp.ucf	2014-04-16 16:50:08.000000000 +0200
+++ work/leon3mp.ucf	2015-11-05 12:40:53.175538451 +0100
@@ -1,544 +1,542 @@
-############################################################################
-## 
-##  Xilinx, Inc. 2006            www.xilinx.com 
-##  Mon Aug 30 10:34:47 2010
-##  Generated by MIG Version 3.6
-##  
-############################################################################
-##  File name :       example_top.ucf
-## 
-##  Details :     Constraints file
-##                    FPGA family:       virtex6
-##                    FPGA:              xc6vlx240t-ff1156
-##                    Speedgrade:        -1
-##                    Design Entry:      VERILOG
-##                    Design:            with Test bench
-##                    No.Of Controllers: 1
-##
-############################################################################ 
-##  Modifications for ML605 with LX240T FPGA
-##  Start with UCF file generated by MIG 3.4 (ISE 12.1 build M.53.d)
-##     
-##  1. Majority of ML605 board specific pin assignments entered via MIG3.4 GUI!
-##     A. Add LOC and IOSTANDARD for LED indicator "heartbeat" 
-##     B. Add LOC and IOSTANDARD for LED indicator "pll_lock" 
-##     C. Comment out "sda" and "scl" signals 
-##     D. ML605 DCI_CASCADE is correct as defined in MIG3.4 GUI.
-##        BANK 26 = left column I/O master; BANK 36 = right column I/O master 
-##  2. Change IOSTANDARD for sys_rst to SSTL15 
-##  3. Board specific clocking definitions
-##     A. Default MIG 3.5 example design assumes 2 clock inputs to design:
-##        1. clk_ref to IDELAY_CTRL element (200 MHz)
-##        2. sys_clk to PLL circuit (SMA inputs)
-##     B. ML605 single clock source, modify constraint file to use 200 MHz 
-##        LVDS clock "clk_ref" input for DDR3 SODIMM design @800 Mbps data rate. 
-##        - Delete sys_clk_p and sys_clk_n inputs (HDL and LOC constraints)
-##        - Comment out sys_clk timing specification
-##        - Modify TS_MC_PHY_INIT_SEL to use value "2.5 ns" in multiplication 
-##  4. Optional: comment out CONFIG_PROHIBIT lines (pins reserved for MIG)
-##     Since this design has LOC'ed I/O don't need to reserve these pins.
-##  5. ML605 MIG3.4 BUFIO pin assignments
-##         BUFIO:0 pin C13 => X2Y137
-##         BUFIO:1 pin L13 => X2Y141
-##         BUFIO:2 pin K14 => X2Y143
-##         BUFIO:3 pin F21 => X1Y179
-##         BUFIO:4 pin B20 => X1Y181
-##         BUFIO:5 pin F25 => X1Y137
-##         BUFIO:6 pin C28 => X1Y141
-##         BUFIO:7 pin D24 => X1Y143
-##  6. ML605 MIG3.4 BUFR pin assignments
-##         BUFR:0 pin M12 => X2Y139
-##         BUFR:1 pin C29 => X1Y139
-##
-############################################################################
-# Timing constraints                                                        #
-############################################################################
-## ML605 comment out the following 2 lines for single 200MHz input clock
-## NET "sys_clk_p" TNM_NET = TNM_sys_clk;
-## TIMESPEC "TS_sys_clk" = PERIOD "TNM_sys_clk" 2.5 ns;
-
-NET "clk_ref_p" TNM_NET = TNM_clk_ref;
-TIMESPEC "TS_clk_ref" = PERIOD "TNM_clk_ref" 5 ns ;
-
-# Constrain BUFR clocks used to synchronize data from IOB to fabric logic
-# Note that ISE cannot infer this from other PERIOD constraints because
-# of the use of OSERDES blocks in the BUFR clock generation path
-NET "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/clk_rsync(?)" TNM_NET = TNM_clk_rsync;
-TIMESPEC "TS_clk_rsync" = PERIOD "TNM_clk_rsync" 5 ns;
-
-# Paths between DQ/DQS ISERDES.Q outputs and CLB flops clocked by falling 
-# edge of BUFR will by design only be used if DYNCLKDIVSEL is asserted for 
-# that particular flop. Mark this path as being a full-cycle, rather than 
-# a half cycle path for timing purposes. NOTE: This constraint forces full-
-# cycle timing to be applied globally for all rising->falling edge paths 
-# in all resynchronizaton clock domains. If the user had modified the logic
-# in the resync clock domain such that other rising->falling edge paths 
-# exist, then constraint below should be modified to utilize pattern 
-# matching to specific affect only the DQ/DQS ISERDES.Q outputs
-TIMEGRP "TG_clk_rsync_rise" = RISING  "TNM_clk_rsync";
-TIMEGRP "TG_clk_rsync_fall" = FALLING "TNM_clk_rsync";
-TIMESPEC "TS_clk_rsync_rise_to_fall" = 
-  FROM "TG_clk_rsync_rise" TO "TG_clk_rsync_fall" "TS_sys_clk" * 2;
-
-# Signal to select between controller and physical layer signals. Four divided by two clock
-# cycles (8 memory clock cycles) are provided by design for the signal to settle down.
-# Used only by the phy modules.
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_init/u_ff_phy_init_data_sel" TNM = "TNM_PHY_INIT_SEL";
-TIMESPEC "TS_MC_PHY_INIT_SEL" = FROM "TNM_PHY_INIT_SEL" TO FFS = 10 ns;  ## = "2.5ns * 4" ML605 single clock
-
-disable = reg_sr_o;
-disable = reg_sr_r;
-############################################################################
-########################################################################
-# Controller 0
-# Memory Device: DDR3_SDRAM->SODIMMs->MT4JSF6464HY-1G1
-# Data Width:     64
-# Frequency:      400
-# Time Period:      2500
-# Data Mask:     1
-########################################################################
-
-
-################################################################################
-# I/O STANDARDS
-################################################################################
-
-NET  "ddr3_dq(*)"                               IOSTANDARD = SSTL15_T_DCI;
-NET  "ddr3_addr(*)"                             IOSTANDARD = SSTL15;
-NET  "ddr3_ba(*)"                               IOSTANDARD = SSTL15;
-NET  "ddr3_ras_n"                               IOSTANDARD = SSTL15;
-NET  "ddr3_cas_n"                               IOSTANDARD = SSTL15;
-NET  "ddr3_we_n"                                IOSTANDARD = SSTL15;
-NET  "ddr3_reset_n"                             IOSTANDARD = SSTL15;
-NET  "ddr3_cke(*)"                              IOSTANDARD = SSTL15;
-NET  "ddr3_odt(*)"                              IOSTANDARD = SSTL15;
-NET  "ddr3_cs_n(*)"                             IOSTANDARD = SSTL15;
-NET  "ddr3_dm(*)"                               IOSTANDARD = SSTL15;
-## NET  "sys_clk_p"                                IOSTANDARD = LVDS_25;
-## NET  "sys_clk_n"                                IOSTANDARD = LVDS_25;
-NET  "clk_ref_p"                                IOSTANDARD = LVDS_25;
-NET  "clk_ref_n"                                IOSTANDARD = LVDS_25;
-## NET  "sda"                                      IOSTANDARD = LVCMOS25;
-## NET  "scl"                                      IOSTANDARD = LVCMOS25;
-NET  "reset"                                  IOSTANDARD = SSTL15;      ## ML605 
-#NET  "phy_init_done"                            IOSTANDARD = LVCMOS25;
-NET  "errorn"                                    IOSTANDARD = LVCMOS25;
-NET  "ddr3_dqs_p(*)"                            IOSTANDARD = DIFF_SSTL15_T_DCI;
-NET  "ddr3_dqs_n(*)"                            IOSTANDARD = DIFF_SSTL15_T_DCI;
-NET  "ddr3_ck_p(*)"                             IOSTANDARD = DIFF_SSTL15;
-NET  "ddr3_ck_n(*)"                             IOSTANDARD = DIFF_SSTL15;
-
-################################################################################
-##SAVE attributes to reserve the pins
-################################################################################
-## NET  "sda"                                      S;
-## NET  "scl"                                      S;
-
-###############################################################################
-#DCI_CASCADING
-#Syntax : CONFIG DCI_CASCADE = "<master> <slave1> <slave2> ..";
-###############################################################################
-CONFIG DCI_CASCADE = "26 25";
-CONFIG DCI_CASCADE = "36 35";
-
-
-##################################################################################
-# Location Constraints
-##################################################################################
-NET  "ddr3_dq(0)"                                LOC = "J11" ;          #Bank 35
-NET  "ddr3_dq(1)"                                LOC = "E13" ;          #Bank 35
-NET  "ddr3_dq(2)"                                LOC = "F13" ;          #Bank 35
-NET  "ddr3_dq(3)"                                LOC = "K11" ;          #Bank 35
-NET  "ddr3_dq(4)"                                LOC = "L11" ;          #Bank 35
-NET  "ddr3_dq(5)"                                LOC = "K13" ;          #Bank 35
-NET  "ddr3_dq(6)"                                LOC = "K12" ;          #Bank 35
-NET  "ddr3_dq(7)"                                LOC = "D11" ;          #Bank 35
-NET  "ddr3_dq(8)"                                LOC = "M13" ;          #Bank 35
-NET  "ddr3_dq(9)"                                LOC = "J14" ;          #Bank 35
-NET  "ddr3_dq(10)"                               LOC = "B13" ;          #Bank 35
-NET  "ddr3_dq(11)"                               LOC = "B12" ;          #Bank 35
-NET  "ddr3_dq(12)"                               LOC = "G10" ;          #Bank 35
-NET  "ddr3_dq(13)"                               LOC = "M11" ;          #Bank 35
-NET  "ddr3_dq(14)"                               LOC = "C12" ;          #Bank 35
-NET  "ddr3_dq(15)"                               LOC = "A11" ;          #Bank 35
-NET  "ddr3_dq(16)"                               LOC = "G11" ;          #Bank 35
-NET  "ddr3_dq(17)"                               LOC = "F11" ;          #Bank 35
-NET  "ddr3_dq(18)"                               LOC = "D14" ;          #Bank 35
-NET  "ddr3_dq(19)"                               LOC = "C14" ;          #Bank 35
-NET  "ddr3_dq(20)"                               LOC = "G12" ;          #Bank 35
-NET  "ddr3_dq(21)"                               LOC = "G13" ;          #Bank 35
-NET  "ddr3_dq(22)"                               LOC = "F14" ;          #Bank 35
-NET  "ddr3_dq(23)"                               LOC = "H14" ;          #Bank 35
-NET  "ddr3_dq(24)"                               LOC = "C19" ;          #Bank 26
-NET  "ddr3_dq(25)"                               LOC = "G20" ;          #Bank 26
-NET  "ddr3_dq(26)"                               LOC = "E19" ;          #Bank 26
-NET  "ddr3_dq(27)"                               LOC = "F20" ;          #Bank 26
-NET  "ddr3_dq(28)"                               LOC = "A20" ;          #Bank 26
-NET  "ddr3_dq(29)"                               LOC = "A21" ;          #Bank 26
-NET  "ddr3_dq(30)"                               LOC = "E22" ;          #Bank 26
-NET  "ddr3_dq(31)"                               LOC = "E23" ;          #Bank 26
-NET  "ddr3_dq(32)"                               LOC = "G21" ;          #Bank 26
-NET  "ddr3_dq(33)"                               LOC = "B21" ;          #Bank 26
-NET  "ddr3_dq(34)"                               LOC = "A23" ;          #Bank 26
-NET  "ddr3_dq(35)"                               LOC = "A24" ;          #Bank 26
-NET  "ddr3_dq(36)"                               LOC = "C20" ;          #Bank 26
-NET  "ddr3_dq(37)"                               LOC = "D20" ;          #Bank 26
-NET  "ddr3_dq(38)"                               LOC = "J20" ;          #Bank 26
-NET  "ddr3_dq(39)"                               LOC = "G22" ;          #Bank 26
-NET  "ddr3_dq(40)"                               LOC = "D26" ;          #Bank 25
-NET  "ddr3_dq(41)"                               LOC = "F26" ;          #Bank 25
-NET  "ddr3_dq(42)"                               LOC = "B26" ;          #Bank 25
-NET  "ddr3_dq(43)"                               LOC = "E26" ;          #Bank 25
-NET  "ddr3_dq(44)"                               LOC = "C24" ;          #Bank 25
-NET  "ddr3_dq(45)"                               LOC = "D25" ;          #Bank 25
-NET  "ddr3_dq(46)"                               LOC = "D27" ;          #Bank 25
-NET  "ddr3_dq(47)"                               LOC = "C25" ;          #Bank 25
-NET  "ddr3_dq(48)"                               LOC = "C27" ;          #Bank 25
-NET  "ddr3_dq(49)"                               LOC = "B28" ;          #Bank 25
-NET  "ddr3_dq(50)"                               LOC = "D29" ;          #Bank 25
-NET  "ddr3_dq(51)"                               LOC = "B27" ;          #Bank 25
-NET  "ddr3_dq(52)"                               LOC = "G27" ;          #Bank 25
-NET  "ddr3_dq(53)"                               LOC = "A28" ;          #Bank 25
-NET  "ddr3_dq(54)"                               LOC = "E24" ;          #Bank 25
-NET  "ddr3_dq(55)"                               LOC = "G25" ;          #Bank 25
-NET  "ddr3_dq(56)"                               LOC = "F28" ;          #Bank 25
-NET  "ddr3_dq(57)"                               LOC = "B31" ;          #Bank 25
-NET  "ddr3_dq(58)"                               LOC = "H29" ;          #Bank 25
-NET  "ddr3_dq(59)"                               LOC = "H28" ;          #Bank 25
-NET  "ddr3_dq(60)"                               LOC = "B30" ;          #Bank 25
-NET  "ddr3_dq(61)"                               LOC = "A30" ;          #Bank 25
-NET  "ddr3_dq(62)"                               LOC = "E29" ;          #Bank 25
-NET  "ddr3_dq(63)"                               LOC = "F29" ;          #Bank 25
-NET  "ddr3_addr(12)"                             LOC = "H15" ;          #Bank 36
-NET  "ddr3_addr(11)"                             LOC = "M15" ;          #Bank 36
-NET  "ddr3_addr(10)"                             LOC = "M16" ;          #Bank 36
-NET  "ddr3_addr(9)"                              LOC = "F15" ;          #Bank 36
-NET  "ddr3_addr(8)"                              LOC = "G15" ;          #Bank 36
-NET  "ddr3_addr(7)"                              LOC = "B15" ;          #Bank 36
-NET  "ddr3_addr(6)"                              LOC = "A15" ;          #Bank 36
-NET  "ddr3_addr(5)"                              LOC = "J17" ;          #Bank 36
-NET  "ddr3_addr(4)"                              LOC = "D16" ;          #Bank 36
-NET  "ddr3_addr(3)"                              LOC = "E16" ;          #Bank 36
-NET  "ddr3_addr(2)"                              LOC = "B16" ;          #Bank 36
-NET  "ddr3_addr(1)"                              LOC = "A16" ;          #Bank 36
-NET  "ddr3_addr(0)"                              LOC = "L14" ;          #Bank 36
-NET  "ddr3_ba(2)"                                LOC = "L15" ;          #Bank 36
-NET  "ddr3_ba(1)"                                LOC = "J19" ;          #Bank 36
-NET  "ddr3_ba(0)"                                LOC = "K19" ;          #Bank 36
-NET  "ddr3_ras_n"                                LOC = "L19" ;          #Bank 36
-NET  "ddr3_cas_n"                                LOC = "C17" ;          #Bank 36
-NET  "ddr3_we_n"                                 LOC = "B17" ;          #Bank 36
-NET  "ddr3_reset_n"                              LOC = "E18" ;          #Bank 36
-NET  "ddr3_cke(0)"                               LOC = "M18" ;          #Bank 36
-NET  "ddr3_odt(0)"                               LOC = "F18" ;          #Bank 36
-NET  "ddr3_cs_n(0)"                              LOC = "K18" ;          #Bank 36
-NET  "ddr3_dm(0)"                                LOC = "E11" ;          #Bank 35
-NET  "ddr3_dm(1)"                                LOC = "B11" ;          #Bank 35
-NET  "ddr3_dm(2)"                                LOC = "E14" ;          #Bank 35
-NET  "ddr3_dm(3)"                                LOC = "D19" ;          #Bank 26
-NET  "ddr3_dm(4)"                                LOC = "B22" ;          #Bank 26
-NET  "ddr3_dm(5)"                                LOC = "A26" ;          #Bank 25
-NET  "ddr3_dm(6)"                                LOC = "A29" ;          #Bank 25
-NET  "ddr3_dm(7)"                                LOC = "A31" ;          #Bank 25
-## NET  "sys_clk_p"                                 LOC = "J9" ;          #Bank 34
-## NET  "sys_clk_n"                                 LOC = "H9" ;          #Bank 34
-NET  "clk_ref_p"                                 LOC = "J9" ;          #Bank 34
-NET  "clk_ref_n"                                 LOC = "H9" ;          #Bank 34
-## NET  "sda"                                       LOC = "F9" ;          #Bank 34
-## NET  "scl"                                       LOC = "F10" ;          #Bank 34
-NET  "reset"                                   LOC = "H10" ;          #ML605 CPU_RESET switch
-#NET  "phy_init_done"                             LOC = "AE23" ;         #ML605 GPIO LED 3
-NET  "errorn"                                     LOC = "AD24" ;         #ML605 GPIO LED 2
-NET  "ddr3_dqs_p(0)"                             LOC = "D12" ;          #Bank 35
-NET  "ddr3_dqs_n(0)"                             LOC = "E12" ;          #Bank 35
-NET  "ddr3_dqs_p(1)"                             LOC = "H12" ;          #Bank 35
-NET  "ddr3_dqs_n(1)"                             LOC = "J12" ;          #Bank 35
-NET  "ddr3_dqs_p(2)"                             LOC = "A13" ;          #Bank 35
-NET  "ddr3_dqs_n(2)"                             LOC = "A14" ;          #Bank 35
-NET  "ddr3_dqs_p(3)"                             LOC = "H19" ;          #Bank 26
-NET  "ddr3_dqs_n(3)"                             LOC = "H20" ;          #Bank 26
-NET  "ddr3_dqs_p(4)"                             LOC = "B23" ;          #Bank 26
-NET  "ddr3_dqs_n(4)"                             LOC = "C23" ;          #Bank 26
-NET  "ddr3_dqs_p(5)"                             LOC = "B25" ;          #Bank 25
-NET  "ddr3_dqs_n(5)"                             LOC = "A25" ;          #Bank 25
-NET  "ddr3_dqs_p(6)"                             LOC = "H27" ;          #Bank 25
-NET  "ddr3_dqs_n(6)"                             LOC = "G28" ;          #Bank 25
-NET  "ddr3_dqs_p(7)"                             LOC = "C30" ;          #Bank 25
-NET  "ddr3_dqs_n(7)"                             LOC = "D30" ;          #Bank 25
-NET  "ddr3_ck_p(0)"                              LOC = "G18" ;          #Bank 36
-NET  "ddr3_ck_n(0)"                              LOC = "H18" ;          #Bank 36
-
-
-##################################################################################################
-##The following locations must be reserved and cannot be used for external I/O because          ##
-##the I/O elements associated with these sites (IODELAY, OSERDES, and associated routing)       ##
-##are used to generate and route the clocks necessary for read data capture and synchronization ##
-##to the core clock domain. These pins should not be routed out on the user's PCB               ##
-##################################################################################################
-
-##################################################################################################
-##The logic of this pin is used internally to drive a BUFR in the column. This chosen pin must  ##
-##be a clock pin capable of spanning to all of the banks containing data bytes in the particular##
-##column. That is, all byte groups must be within +/- 1 bank of this pin. This pin cannot be    ##
-##used for other functions and should not be connected externally. If a different pin is chosen,##
-##he corresponding LOC constraint must also be changed.                                         ##
-##################################################################################################
-
-CONFIG PROHIBIT = C29,M12;
-
-######################################################################################
-##Place RSYNC OSERDES and IODELAY:                                                  ##
-######################################################################################
-
-##Site: C29 -- Bank 25
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_loop_col1.u_oserdes_rsync"
-  LOC = "OLOGIC_X1Y139";
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_loop_col1.u_odelay_rsync"
-  LOC = "IODELAY_X1Y139";
-
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_loop_col1.u_bufr_rsync"
-  LOC = "BUFR_X1Y6";
-
-##Site: M12 -- Bank 35
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_loop_col0.u_oserdes_rsync"
-  LOC = "OLOGIC_X2Y139";
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_loop_col0.u_odelay_rsync"
-  LOC = "IODELAY_X2Y139";
-
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_loop_col0.u_bufr_rsync"
-  LOC = "BUFR_X2Y6";
-
-##################################################################################################
-##The logic of this pin is used internally to drive a BUFIO for the byte group. Any clock       ##
-##capable pin in the same bank as the data byte group (DQS, DQ, DM if used) can be used for     ##
-##this pin. This pin cannot be used for other functions and should not be connected externally. ##
-##If a different pin is chosen, the corresponding LOC constraint must also be changed.          ##
-##################################################################################################
-
-CONFIG PROHIBIT = B20,C13,C28,D24,F21,F25,K14,L13;
-
-######################################################################################
-##Place CPT OSERDES and IODELAY:                                                    ##
-######################################################################################
-
-##Site: C13 -- Bank 35
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*0*u_oserdes_cpt"
-  LOC = "OLOGIC_X2Y137";
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*0*u_odelay_cpt"
-  LOC = "IODELAY_X2Y137";
-
-##Site: L13 -- Bank 35
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*1*u_oserdes_cpt"
-  LOC = "OLOGIC_X2Y141";
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*1*u_odelay_cpt"
-  LOC = "IODELAY_X2Y141";
-
-##Site: K14 -- Bank 35
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*2*u_oserdes_cpt"
-  LOC = "OLOGIC_X2Y143";
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*2*u_odelay_cpt"
-  LOC = "IODELAY_X2Y143";
-
-##Site: F21 -- Bank 26
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*3*u_oserdes_cpt"
-  LOC = "OLOGIC_X1Y179";
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*3*u_odelay_cpt"
-  LOC = "IODELAY_X1Y179";
-
-##Site: B20 -- Bank 26
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*4*u_oserdes_cpt"
-  LOC = "OLOGIC_X1Y181";
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*4*u_odelay_cpt"
-  LOC = "IODELAY_X1Y181";
-
-##Site: F25 -- Bank 25
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*5*u_oserdes_cpt"
-  LOC = "OLOGIC_X1Y137";
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*5*u_odelay_cpt"
-  LOC = "IODELAY_X1Y137";
-
-##Site: C28 -- Bank 25
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*6*u_oserdes_cpt"
-  LOC = "OLOGIC_X1Y141";
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*6*u_odelay_cpt"
-  LOC = "IODELAY_X1Y141";
-
-##Site: D24 -- Bank 25
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*7*u_oserdes_cpt"
-  LOC = "OLOGIC_X1Y143";
-INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*7*u_odelay_cpt"
-  LOC = "IODELAY_X1Y143";
-
-
-######################################################################################
-## MMCM_ADV CONSTRAINTS                                                             ##
-######################################################################################
-
-INST "ddr3ctrl/u_infrastructure/u_mmcm_adv"      LOC = "MMCM_ADV_X0Y8"; #Banks 16, 26, 36
-
-
-
-###########################################################################
-##  ML605 additions
-###########################################################################
-#NET  "pll_lock"                 IOSTANDARD = LVCMOS25;
-#NET  "heartbeat"                IOSTANDARD = LVCMOS25;
-
-#NET  "heartbeat"                LOC = "AC24";   # ML605 GPIO LED 1
-#NET  "pll_lock"                 LOC = "AC22" ;  # ML605 GPIO LED 0
-
-
-NET "address(0)"                      LOC = "AL8";    ## 29 on U4, A1 on U27
-NET "address(1)"                      LOC = "AK8";    ## 25 on U4, B1 on U27
-NET "address(2)"                      LOC = "AC9";    ## 24 on U4, C1 on U27
-NET "address(3)"                      LOC = "AD10";   ## 23 on U4, D1 on U27
-NET "address(4)"                      LOC = "C8";     ## 22 on U4, D2 on U27
-NET "address(5)"                      LOC = "B8";     ## 21 on U4, A2 on U27
-NET "address(6)"                      LOC = "E9";     ## 20 on U4, C2 on U27
-NET "address(7)"                      LOC = "E8";     ## 19 on U4, A3 on U27
-NET "address(8)"                      LOC = "A8";     ## 8  on U4, B3 on U27
-NET "address(9)"                      LOC = "A9";     ## 7  on U4, C3 on U27
-NET "address(10)"                     LOC = "D9";     ## 6  on U4, D3 on U27
-NET "address(11)"                     LOC = "C9";     ## 5  on U4, C4 on U27
-NET "address(12)"                     LOC = "D10";    ## 4  on U4, A5 on U27
-NET "address(13)"                     LOC = "C10";    ## 3  on U4, B5 on U27
-NET "address(14)"                     LOC = "F10";    ## 2  on U4, C5 on U27
-NET "address(15)"                     LOC = "F9";     ## 1  on U4, D7 on U27
-NET "address(16)"                     LOC = "AH8";    ## 55 on U4, D8 on U27
-NET "address(17)"                     LOC = "AG8";    ## 18 on U4, A7 on U27
-NET "address(18)"                     LOC = "AP9";    ## 17 on U4, B7 on U27
-NET "address(19)"                     LOC = "AN9";    ## 16 on U4, C7 on U27
-NET "address(20)"                     LOC = "AF10";   ## 11 on U4, C8 on U27
-NET "address(21)"                     LOC = "AF9";    ## 10 on U4, A8 on U27
-NET "address(22)"                     LOC = "AL9";    ## 9  on U4, G1 on U27
-NET "address(23)"                     LOC = "AA23";   ## 26 on U4
-NET "data(0)"                      LOC = "AF24";   ## 34 on U4, F2 on U27
-NET "data(1)"                      LOC = "AF25";   ## 36 on U4, E2 on U27
-NET "data(2)"                      LOC = "W24";    ## 39 on U4, G3 on U27
-NET "data(3)"                      LOC = "V24";    ## 41 on U4, E4 on U27
-NET "data(4)"                      LOC = "H24";    ## 47 on U4, E5 on U27
-NET "data(5)"                      LOC = "H25";    ## 49 on U4, G5 on U27
-NET "data(6)"                      LOC = "P24";    ## 51 on U4, G6 on U27
-NET "data(7)"                      LOC = "R24";    ## 53 on U4, H7 on U27
-NET "data(8)"                      LOC = "G23";    ## 35 on U4, E1 on U27
-NET "data(9)"                      LOC = "H23";    ## 37 on U4, E3 on U27
-NET "data(10)"                     LOC = "N24";    ## 40 on U4, F3 on U27
-NET "data(11)"                     LOC = "N23";    ## 42 on U4, F4 on U27
-NET "data(12)"                     LOC = "F23";    ## 48 on U4, F5 on U27
-NET "data(13)"                     LOC = "F24";    ## 50 on U4, H5 on U27
-NET "data(14)"                     LOC = "L24";    ## 52 on U4, G7 on U27
-NET "data(15)"                     LOC = "M23";    ## 54 on U4, E7 on U27
-#NET "FLASH_WAIT"                    LOC = "J26";    ## 56 on U4
-NET "writen"                    LOC = "AF23";   ## 14 on U4, G8 on U27
-NET "oen"                    LOC = "AA24";   ## 32 on U4, F8 on U27
-#NET "FPGA_CCLK"                     LOC = "K8";     ##           F1 on U27
-NET "alatch"                 LOC = "AC23";   ##           H1 on U27
-NET "romsn"                    LOC = "Y24";    ## 30 on U4, B4 on U27 (U10 and switch S2.2 setting select either U4 or U27)
-##
-
-NET "erx_col"                       LOC = "AK13";   ## 114 on U80
-NET "erx_crs"                       LOC = "AL13";   ## 115 on U80
-NET "emdint"                       LOC = "AH14";   ## 32  on U80
-NET "emdc"                       LOC = "AP14";   ## 35  on U80
-NET "emdio"                      LOC = "AN14";   ## 33  on U80
-NET "erstn"                     LOC = "AH13";   ## 36  on U80
-NET "erx_clk"                     LOC = "AP11";   ## 7   on U80
-NET "erx_dv"                LOC = "AM13";   ## 4   on U80
-NET "erxd(0)"                      LOC = "AN13";   ## 3   on U80
-NET "erxd(1)"                      LOC = "AF14";   ## 128 on U80
-NET "erxd(2)"                      LOC = "AE14";   ## 126 on U80
-NET "erxd(3)"                      LOC = "AN12";   ## 125 on U80
-NET "erxd(4)"                      LOC = "AM12";   ## 124 on U80
-NET "erxd(5)"                      LOC = "AD11";   ## 123 on U80
-NET "erxd(6)"                      LOC = "AC12";   ## 121 on U80
-NET "erxd(7)"                      LOC = "AC13";   ## 120 on U80
-NET "erx_er"                      LOC = "AG12";   ## 9   on U80
-NET "etx_clk"                     LOC = "AD12";   ## 10  on U80
-NET "etx_en"                LOC = "AJ10";   ## 16  on U80
-NET "egtx_clk"                LOC = "AH12";   ## 14  on U80
-NET "etxd(0)"                      LOC = "AM11";   ## 18  on U80
-NET "etxd(1)"                      LOC = "AL11";   ## 19  on U80
-NET "etxd(2)"                      LOC = "AG10";   ## 20  on U80
-NET "etxd(3)"                      LOC = "AG11";   ## 24  on U80
-NET "etxd(4)"                      LOC = "AL10";   ## 25  on U80
-NET "etxd(5)"                      LOC = "AM10";   ## 26  on U80
-NET "etxd(6)"                      LOC = "AE11";   ## 28  on U80
-NET "etxd(7)"                      LOC = "AF11";   ## 29  on U80
-NET "etx_er"                      LOC = "AH10";   ## 13  on U80
-
-NET "dsurx"                      LOC = "J24";    ## 24  on U34
-NET "dsutx"                      LOC = "J25";    ## 25  on U34
-
-#NET "GPIO_DIP_SW1"                  LOC = "D22";    ## 1   on SW1 DIP switch (active-high)
-#NET "GPIO_DIP_SW2"                  LOC = "C22";    ## 2   on SW1 DIP switch (active-high)
-#NET "GPIO_DIP_SW3"                  LOC = "L21";    ## 3   on SW1 DIP switch (active-high)
-#NET "GPIO_DIP_SW4"                  LOC = "L20";    ## 4   on SW1 DIP switch (active-high)
-#NET "GPIO_DIP_SW5"                  LOC = "C18";    ## 5   on SW1 DIP switch (active-high)
-NET "dsubre"                  LOC = "B18";    ## 6   on SW1 DIP switch (active-high)
-#NET "GPIO_DIP_SW7"                  LOC = "K22";    ## 7   on SW1 DIP switch (active-high)
-#NET "GPIO_DIP_SW8"                  LOC = "K21";    ## 8   on SW1 DIP switch (active-high)
-##
-
-NET "led(0)"                    LOC = "AC22";   ## 2   on LED DS12, 1 on J62
-NET "led(1)"                    LOC = "AC24";   ## 2   on LED DS11, 2 on J62
-NET "led(2)"                    LOC = "AE22";   ## 2   on LED DS9,  3 on J62
-NET "led(3)"                    LOC = "AE23";   ## 2   on LED DS10, 4 on J62
-NET "led(4)"                    LOC = "AB23";   ## 2   on LED DS15, 5 on J62
-NET "led(4)"                    LOC = "AB23";   ## 2   on LED DS15, 5 on J62
-NET "led(5)"                    LOC = "AG23";   ## 2   on LED DS14, 6 on J62
-#NET "GPIO_LED_5"                    LOC = "AG23";   ## 2   on LED DS14, 6 on J62
-#NET "GPIO_LED_6"                    LOC = "AE24";   ## 2   on LED DS22, 7 on J62
-#NET "GPIO_LED_7"                    LOC = "AD24";   ## 2   on LED DS21, 8 on J62
-
-NET "dvi_iic_scl"                   LOC = "AN10";   ## 2   on Q5, 15 on U38
-NET "iic_scl_main"               LOC = "AK9";    ## 2   on Q19
-#NET "IIC_SCL_SFP"                   LOC = "AA34";   ## 2   on Q23
-NET "dvi_iic_sda"                   LOC = "AP10";   ## 2   on Q6, 14 on U38
-NET "iic_sda_main"               LOC = "AE9";    ## 2   on Q20
-#NET "IIC_SDA_SFP"                   LOC = "AA33";   ## 2   on Q21
-
-NET "tft_lcd_data(0)"                        LOC = "AJ19";   ## 63 on U38 (thru series R111 47.5 ohm)
-NET "tft_lcd_data(1)"                        LOC = "AH19";   ## 62 on U38 (thru series R110 47.5 ohm)
-NET "tft_lcd_data(2)"                        LOC = "AM17";   ## 61 on U38 (thru series R109 47.5 ohm)
-NET "tft_lcd_data(3)"                        LOC = "AM16";   ## 60 on U38 (thru series R108 47.5 ohm)
-NET "tft_lcd_data(4)"                        LOC = "AD17";   ## 59 on U38 (thru series R107 47.5 ohm)
-NET "tft_lcd_data(5)"                        LOC = "AE17";   ## 58 on U38 (thru series R106 47.5 ohm)
-NET "tft_lcd_data(6)"                        LOC = "AK18";   ## 55 on U38 (thru series R105 47.5 ohm)
-NET "tft_lcd_data(7)"                        LOC = "AK17";   ## 54 on U38 (thru series R104 47.5 ohm)
-NET "tft_lcd_data(8)"                        LOC = "AE18";   ## 53 on U38 (thru series R103 47.5 ohm)
-NET "tft_lcd_data(9)"                        LOC = "AF18";   ## 52 on U38 (thru series R102 47.5 ohm)
-NET "tft_lcd_data(10)"                       LOC = "AL16";   ## 51 on U38 (thru series R101 47.5 ohm)
-NET "tft_lcd_data(11)"                       LOC = "AK16";   ## 50 on U38 (thru series R100 47.5 ohm)
-NET "tft_lcd_de"                        LOC = "AD16";   ## 2  on U38 (thru series R112 47.5 ohm)
-#NET "DVI_GPIO1_FMC_C2M_PG_LS"       LOC = "K9";     ## 18 on U32 (not wired to U38)
-NET "tft_lcd_hsync"                         LOC = "AN17";   ## 4  on U38 (thru series R113 47.5 ohm)
-NET "tft_lcd_reset_b"                LOC = "AP17";   ## 2  on U32 (DVI_RESET_B pin 13 on U38)
-NET "tft_lcd_vsync"                         LOC = "AD15";   ## 5  on U38 (thru series R114 47.5 ohm)
-NET "tft_lcd_clk_n"                    LOC = "AC17";   ## 56 on U38
-NET "tft_lcd_clk_p"                    LOC = "AC18";   ## 57 on U38
-
-#NET "SYSACE_CFGTDI"                 LOC = "AC8";    ## 81  on U19
-NET "sysace_d(0)"                     LOC = "AM15";   ## 66  on U19
-NET "sysace_d(1)"                     LOC = "AJ17";   ## 65  on U19
-NET "sysace_d(2)"                     LOC = "AJ16";   ## 63  on U19
-NET "sysace_d(3)"                     LOC = "AP16";   ## 62  on U19
-NET "sysace_d(4)"                     LOC = "AG16";   ## 61  on U19
-NET "sysace_d(5)"                     LOC = "AH15";   ## 60  on U19
-NET "sysace_d(6)"                     LOC = "AF16";   ## 59  on U19
-NET "sysace_d(7)"                     LOC = "AN15";   ## 58  on U19
-NET "sysace_mpa(0)"                  LOC = "AC15";   ## 70  on U19
-NET "sysace_mpa(1)"                  LOC = "AP15";   ## 69  on U19
-NET "sysace_mpa(2)"                  LOC = "AG17";   ## 68  on U19
-NET "sysace_mpa(3)"                  LOC = "AH17";   ## 67  on U19
-NET "sysace_mpa(4)"                  LOC = "AG15";   ## 45  on U19
-NET "sysace_mpa(5)"                  LOC = "AF15";   ## 44  on U19
-NET "sysace_mpa(6)"                  LOC = "AK14";   ## 43  on U19
-#NET "SYSACE_MPBRDY"                 LOC = "AJ15";   ## 39  on U19
-NET "sysace_mpce"                   LOC = "AJ14";   ## 42  on U19
-NET "sysace_mpirq"                  LOC = "L9";     ## 41  on U19
-NET "sysace_mpoe"                   LOC = "AL15";   ## 77  on U19
-NET "sysace_mpwe"                   LOC = "AL14";   ## 76  on U19
-NET "clk_33"              LOC = "AE16";   ## 93  on U19
+############################################################################
+## 
+##  Xilinx, Inc. 2006            www.xilinx.com 
+##  Mon Aug 30 10:34:47 2010
+##  Generated by MIG Version 3.6
+##  
+############################################################################
+##  File name :       example_top.ucf
+## 
+##  Details :     Constraints file
+##                    FPGA family:       virtex6
+##                    FPGA:              xc6vlx240t-ff1156
+##                    Speedgrade:        -1
+##                    Design Entry:      VERILOG
+##                    Design:            with Test bench
+##                    No.Of Controllers: 1
+##
+############################################################################ 
+##  Modifications for ML605 with LX240T FPGA
+##  Start with UCF file generated by MIG 3.4 (ISE 12.1 build M.53.d)
+##     
+##  1. Majority of ML605 board specific pin assignments entered via MIG3.4 GUI!
+##     A. Add LOC and IOSTANDARD for LED indicator "heartbeat" 
+##     B. Add LOC and IOSTANDARD for LED indicator "pll_lock" 
+##     C. Comment out "sda" and "scl" signals 
+##     D. ML605 DCI_CASCADE is correct as defined in MIG3.4 GUI.
+##        BANK 26 = left column I/O master; BANK 36 = right column I/O master 
+##  2. Change IOSTANDARD for sys_rst to SSTL15 
+##  3. Board specific clocking definitions
+##     A. Default MIG 3.5 example design assumes 2 clock inputs to design:
+##        1. clk_ref to IDELAY_CTRL element (200 MHz)
+##        2. sys_clk to PLL circuit (SMA inputs)
+##     B. ML605 single clock source, modify constraint file to use 200 MHz 
+##        LVDS clock "clk_ref" input for DDR3 SODIMM design @800 Mbps data rate. 
+##        - Delete sys_clk_p and sys_clk_n inputs (HDL and LOC constraints)
+##        - Comment out sys_clk timing specification
+##        - Modify TS_MC_PHY_INIT_SEL to use value "2.5 ns" in multiplication 
+##  4. Optional: comment out CONFIG_PROHIBIT lines (pins reserved for MIG)
+##     Since this design has LOC'ed I/O don't need to reserve these pins.
+##  5. ML605 MIG3.4 BUFIO pin assignments
+##         BUFIO:0 pin C13 => X2Y137
+##         BUFIO:1 pin L13 => X2Y141
+##         BUFIO:2 pin K14 => X2Y143
+##         BUFIO:3 pin F21 => X1Y179
+##         BUFIO:4 pin B20 => X1Y181
+##         BUFIO:5 pin F25 => X1Y137
+##         BUFIO:6 pin C28 => X1Y141
+##         BUFIO:7 pin D24 => X1Y143
+##  6. ML605 MIG3.4 BUFR pin assignments
+##         BUFR:0 pin M12 => X2Y139
+##         BUFR:1 pin C29 => X1Y139
+##
+############################################################################
+# Timing constraints                                                        #
+############################################################################
+## ML605 comment out the following 2 lines for single 200MHz input clock
+## NET "sys_clk_p" TNM_NET = TNM_sys_clk;
+## TIMESPEC "TS_sys_clk" = PERIOD "TNM_sys_clk" 2.5 ns;
+
+NET "clk_ref_p" TNM_NET = TNM_clk_ref;
+TIMESPEC "TS_clk_ref" = PERIOD "TNM_clk_ref" 5 ns ;
+
+# Constrain BUFR clocks used to synchronize data from IOB to fabric logic
+# Note that ISE cannot infer this from other PERIOD constraints because
+# of the use of OSERDES blocks in the BUFR clock generation path
+NET "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/clk_rsync(?)" TNM_NET = TNM_clk_rsync;
+TIMESPEC "TS_clk_rsync" = PERIOD "TNM_clk_rsync" 5 ns;
+
+# Paths between DQ/DQS ISERDES.Q outputs and CLB flops clocked by falling 
+# edge of BUFR will by design only be used if DYNCLKDIVSEL is asserted for 
+# that particular flop. Mark this path as being a full-cycle, rather than 
+# a half cycle path for timing purposes. NOTE: This constraint forces full-
+# cycle timing to be applied globally for all rising->falling edge paths 
+# in all resynchronizaton clock domains. If the user had modified the logic
+# in the resync clock domain such that other rising->falling edge paths 
+# exist, then constraint below should be modified to utilize pattern 
+# matching to specific affect only the DQ/DQS ISERDES.Q outputs
+TIMEGRP "TG_clk_rsync_rise" = RISING  "TNM_clk_rsync";
+TIMEGRP "TG_clk_rsync_fall" = FALLING "TNM_clk_rsync";
+TIMESPEC "TS_clk_rsync_rise_to_fall" = 
+  FROM "TG_clk_rsync_rise" TO "TG_clk_rsync_fall" "TS_sys_clk" * 2;
+
+# Signal to select between controller and physical layer signals. Four divided by two clock
+# cycles (8 memory clock cycles) are provided by design for the signal to settle down.
+# Used only by the phy modules.
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_init/u_ff_phy_init_data_sel" TNM = "TNM_PHY_INIT_SEL";
+TIMESPEC "TS_MC_PHY_INIT_SEL" = FROM "TNM_PHY_INIT_SEL" TO FFS = 10 ns;  ## = "2.5ns * 4" ML605 single clock
+
+disable = reg_sr_o;
+disable = reg_sr_r;
+############################################################################
+########################################################################
+# Controller 0
+# Memory Device: DDR3_SDRAM->SODIMMs->MT4JSF6464HY-1G1
+# Data Width:     64
+# Frequency:      400
+# Time Period:      2500
+# Data Mask:     1
+########################################################################
+
+
+################################################################################
+# I/O STANDARDS
+################################################################################
+
+NET  "ddr3_dq(*)"                               IOSTANDARD = SSTL15_T_DCI;
+NET  "ddr3_addr(*)"                             IOSTANDARD = SSTL15;
+NET  "ddr3_ba(*)"                               IOSTANDARD = SSTL15;
+NET  "ddr3_ras_n"                               IOSTANDARD = SSTL15;
+NET  "ddr3_cas_n"                               IOSTANDARD = SSTL15;
+NET  "ddr3_we_n"                                IOSTANDARD = SSTL15;
+NET  "ddr3_reset_n"                             IOSTANDARD = SSTL15;
+NET  "ddr3_cke(*)"                              IOSTANDARD = SSTL15;
+NET  "ddr3_odt(*)"                              IOSTANDARD = SSTL15;
+NET  "ddr3_cs_n(*)"                             IOSTANDARD = SSTL15;
+NET  "ddr3_dm(*)"                               IOSTANDARD = SSTL15;
+## NET  "sys_clk_p"                                IOSTANDARD = LVDS_25;
+## NET  "sys_clk_n"                                IOSTANDARD = LVDS_25;
+NET  "clk_ref_p"                                IOSTANDARD = LVDS_25;
+NET  "clk_ref_n"                                IOSTANDARD = LVDS_25;
+## NET  "sda"                                      IOSTANDARD = LVCMOS25;
+## NET  "scl"                                      IOSTANDARD = LVCMOS25;
+NET  "reset"                                  IOSTANDARD = SSTL15;      ## ML605 
+#NET  "phy_init_done"                            IOSTANDARD = LVCMOS25;
+NET  "errorn"                                    IOSTANDARD = LVCMOS25;
+NET  "ddr3_dqs_p(*)"                            IOSTANDARD = DIFF_SSTL15_T_DCI;
+NET  "ddr3_dqs_n(*)"                            IOSTANDARD = DIFF_SSTL15_T_DCI;
+NET  "ddr3_ck_p(*)"                             IOSTANDARD = DIFF_SSTL15;
+NET  "ddr3_ck_n(*)"                             IOSTANDARD = DIFF_SSTL15;
+
+################################################################################
+##SAVE attributes to reserve the pins
+################################################################################
+## NET  "sda"                                      S;
+## NET  "scl"                                      S;
+
+###############################################################################
+#DCI_CASCADING
+#Syntax : CONFIG DCI_CASCADE = "<master> <slave1> <slave2> ..";
+###############################################################################
+CONFIG DCI_CASCADE = "26 25";
+CONFIG DCI_CASCADE = "36 35";
+
+
+##################################################################################
+# Location Constraints
+##################################################################################
+NET  "ddr3_dq(0)"                                LOC = "J11" ;          #Bank 35
+NET  "ddr3_dq(1)"                                LOC = "E13" ;          #Bank 35
+NET  "ddr3_dq(2)"                                LOC = "F13" ;          #Bank 35
+NET  "ddr3_dq(3)"                                LOC = "K11" ;          #Bank 35
+NET  "ddr3_dq(4)"                                LOC = "L11" ;          #Bank 35
+NET  "ddr3_dq(5)"                                LOC = "K13" ;          #Bank 35
+NET  "ddr3_dq(6)"                                LOC = "K12" ;          #Bank 35
+NET  "ddr3_dq(7)"                                LOC = "D11" ;          #Bank 35
+NET  "ddr3_dq(8)"                                LOC = "M13" ;          #Bank 35
+NET  "ddr3_dq(9)"                                LOC = "J14" ;          #Bank 35
+NET  "ddr3_dq(10)"                               LOC = "B13" ;          #Bank 35
+NET  "ddr3_dq(11)"                               LOC = "B12" ;          #Bank 35
+NET  "ddr3_dq(12)"                               LOC = "G10" ;          #Bank 35
+NET  "ddr3_dq(13)"                               LOC = "M11" ;          #Bank 35
+NET  "ddr3_dq(14)"                               LOC = "C12" ;          #Bank 35
+NET  "ddr3_dq(15)"                               LOC = "A11" ;          #Bank 35
+NET  "ddr3_dq(16)"                               LOC = "G11" ;          #Bank 35
+NET  "ddr3_dq(17)"                               LOC = "F11" ;          #Bank 35
+NET  "ddr3_dq(18)"                               LOC = "D14" ;          #Bank 35
+NET  "ddr3_dq(19)"                               LOC = "C14" ;          #Bank 35
+NET  "ddr3_dq(20)"                               LOC = "G12" ;          #Bank 35
+NET  "ddr3_dq(21)"                               LOC = "G13" ;          #Bank 35
+NET  "ddr3_dq(22)"                               LOC = "F14" ;          #Bank 35
+NET  "ddr3_dq(23)"                               LOC = "H14" ;          #Bank 35
+NET  "ddr3_dq(24)"                               LOC = "C19" ;          #Bank 26
+NET  "ddr3_dq(25)"                               LOC = "G20" ;          #Bank 26
+NET  "ddr3_dq(26)"                               LOC = "E19" ;          #Bank 26
+NET  "ddr3_dq(27)"                               LOC = "F20" ;          #Bank 26
+NET  "ddr3_dq(28)"                               LOC = "A20" ;          #Bank 26
+NET  "ddr3_dq(29)"                               LOC = "A21" ;          #Bank 26
+NET  "ddr3_dq(30)"                               LOC = "E22" ;          #Bank 26
+NET  "ddr3_dq(31)"                               LOC = "E23" ;          #Bank 26
+NET  "ddr3_dq(32)"                               LOC = "G21" ;          #Bank 26
+NET  "ddr3_dq(33)"                               LOC = "B21" ;          #Bank 26
+NET  "ddr3_dq(34)"                               LOC = "A23" ;          #Bank 26
+NET  "ddr3_dq(35)"                               LOC = "A24" ;          #Bank 26
+NET  "ddr3_dq(36)"                               LOC = "C20" ;          #Bank 26
+NET  "ddr3_dq(37)"                               LOC = "D20" ;          #Bank 26
+NET  "ddr3_dq(38)"                               LOC = "J20" ;          #Bank 26
+NET  "ddr3_dq(39)"                               LOC = "G22" ;          #Bank 26
+NET  "ddr3_dq(40)"                               LOC = "D26" ;          #Bank 25
+NET  "ddr3_dq(41)"                               LOC = "F26" ;          #Bank 25
+NET  "ddr3_dq(42)"                               LOC = "B26" ;          #Bank 25
+NET  "ddr3_dq(43)"                               LOC = "E26" ;          #Bank 25
+NET  "ddr3_dq(44)"                               LOC = "C24" ;          #Bank 25
+NET  "ddr3_dq(45)"                               LOC = "D25" ;          #Bank 25
+NET  "ddr3_dq(46)"                               LOC = "D27" ;          #Bank 25
+NET  "ddr3_dq(47)"                               LOC = "C25" ;          #Bank 25
+NET  "ddr3_dq(48)"                               LOC = "C27" ;          #Bank 25
+NET  "ddr3_dq(49)"                               LOC = "B28" ;          #Bank 25
+NET  "ddr3_dq(50)"                               LOC = "D29" ;          #Bank 25
+NET  "ddr3_dq(51)"                               LOC = "B27" ;          #Bank 25
+NET  "ddr3_dq(52)"                               LOC = "G27" ;          #Bank 25
+NET  "ddr3_dq(53)"                               LOC = "A28" ;          #Bank 25
+NET  "ddr3_dq(54)"                               LOC = "E24" ;          #Bank 25
+NET  "ddr3_dq(55)"                               LOC = "G25" ;          #Bank 25
+NET  "ddr3_dq(56)"                               LOC = "F28" ;          #Bank 25
+NET  "ddr3_dq(57)"                               LOC = "B31" ;          #Bank 25
+NET  "ddr3_dq(58)"                               LOC = "H29" ;          #Bank 25
+NET  "ddr3_dq(59)"                               LOC = "H28" ;          #Bank 25
+NET  "ddr3_dq(60)"                               LOC = "B30" ;          #Bank 25
+NET  "ddr3_dq(61)"                               LOC = "A30" ;          #Bank 25
+NET  "ddr3_dq(62)"                               LOC = "E29" ;          #Bank 25
+NET  "ddr3_dq(63)"                               LOC = "F29" ;          #Bank 25
+NET  "ddr3_addr(12)"                             LOC = "H15" ;          #Bank 36
+NET  "ddr3_addr(11)"                             LOC = "M15" ;          #Bank 36
+NET  "ddr3_addr(10)"                             LOC = "M16" ;          #Bank 36
+NET  "ddr3_addr(9)"                              LOC = "F15" ;          #Bank 36
+NET  "ddr3_addr(8)"                              LOC = "G15" ;          #Bank 36
+NET  "ddr3_addr(7)"                              LOC = "B15" ;          #Bank 36
+NET  "ddr3_addr(6)"                              LOC = "A15" ;          #Bank 36
+NET  "ddr3_addr(5)"                              LOC = "J17" ;          #Bank 36
+NET  "ddr3_addr(4)"                              LOC = "D16" ;          #Bank 36
+NET  "ddr3_addr(3)"                              LOC = "E16" ;          #Bank 36
+NET  "ddr3_addr(2)"                              LOC = "B16" ;          #Bank 36
+NET  "ddr3_addr(1)"                              LOC = "A16" ;          #Bank 36
+NET  "ddr3_addr(0)"                              LOC = "L14" ;          #Bank 36
+NET  "ddr3_ba(2)"                                LOC = "L15" ;          #Bank 36
+NET  "ddr3_ba(1)"                                LOC = "J19" ;          #Bank 36
+NET  "ddr3_ba(0)"                                LOC = "K19" ;          #Bank 36
+NET  "ddr3_ras_n"                                LOC = "L19" ;          #Bank 36
+NET  "ddr3_cas_n"                                LOC = "C17" ;          #Bank 36
+NET  "ddr3_we_n"                                 LOC = "B17" ;          #Bank 36
+NET  "ddr3_reset_n"                              LOC = "E18" ;          #Bank 36
+NET  "ddr3_cke(0)"                               LOC = "M18" ;          #Bank 36
+NET  "ddr3_odt(0)"                               LOC = "F18" ;          #Bank 36
+NET  "ddr3_cs_n(0)"                              LOC = "K18" ;          #Bank 36
+NET  "ddr3_dm(0)"                                LOC = "E11" ;          #Bank 35
+NET  "ddr3_dm(1)"                                LOC = "B11" ;          #Bank 35
+NET  "ddr3_dm(2)"                                LOC = "E14" ;          #Bank 35
+NET  "ddr3_dm(3)"                                LOC = "D19" ;          #Bank 26
+NET  "ddr3_dm(4)"                                LOC = "B22" ;          #Bank 26
+NET  "ddr3_dm(5)"                                LOC = "A26" ;          #Bank 25
+NET  "ddr3_dm(6)"                                LOC = "A29" ;          #Bank 25
+NET  "ddr3_dm(7)"                                LOC = "A31" ;          #Bank 25
+## NET  "sys_clk_p"                                 LOC = "J9" ;          #Bank 34
+## NET  "sys_clk_n"                                 LOC = "H9" ;          #Bank 34
+NET  "clk_ref_p"                                 LOC = "J9" ;          #Bank 34
+NET  "clk_ref_n"                                 LOC = "H9" ;          #Bank 34
+## NET  "sda"                                       LOC = "F9" ;          #Bank 34
+## NET  "scl"                                       LOC = "F10" ;          #Bank 34
+NET  "reset"                                   LOC = "H10" ;          #ML605 CPU_RESET switch
+#NET  "phy_init_done"                             LOC = "AE23" ;         #ML605 GPIO LED 3
+NET  "errorn"                                     LOC = "AD24" ;         #ML605 GPIO LED 2
+NET  "ddr3_dqs_p(0)"                             LOC = "D12" ;          #Bank 35
+NET  "ddr3_dqs_n(0)"                             LOC = "E12" ;          #Bank 35
+NET  "ddr3_dqs_p(1)"                             LOC = "H12" ;          #Bank 35
+NET  "ddr3_dqs_n(1)"                             LOC = "J12" ;          #Bank 35
+NET  "ddr3_dqs_p(2)"                             LOC = "A13" ;          #Bank 35
+NET  "ddr3_dqs_n(2)"                             LOC = "A14" ;          #Bank 35
+NET  "ddr3_dqs_p(3)"                             LOC = "H19" ;          #Bank 26
+NET  "ddr3_dqs_n(3)"                             LOC = "H20" ;          #Bank 26
+NET  "ddr3_dqs_p(4)"                             LOC = "B23" ;          #Bank 26
+NET  "ddr3_dqs_n(4)"                             LOC = "C23" ;          #Bank 26
+NET  "ddr3_dqs_p(5)"                             LOC = "B25" ;          #Bank 25
+NET  "ddr3_dqs_n(5)"                             LOC = "A25" ;          #Bank 25
+NET  "ddr3_dqs_p(6)"                             LOC = "H27" ;          #Bank 25
+NET  "ddr3_dqs_n(6)"                             LOC = "G28" ;          #Bank 25
+NET  "ddr3_dqs_p(7)"                             LOC = "C30" ;          #Bank 25
+NET  "ddr3_dqs_n(7)"                             LOC = "D30" ;          #Bank 25
+NET  "ddr3_ck_p(0)"                              LOC = "G18" ;          #Bank 36
+NET  "ddr3_ck_n(0)"                              LOC = "H18" ;          #Bank 36
+
+
+##################################################################################################
+##The following locations must be reserved and cannot be used for external I/O because          ##
+##the I/O elements associated with these sites (IODELAY, OSERDES, and associated routing)       ##
+##are used to generate and route the clocks necessary for read data capture and synchronization ##
+##to the core clock domain. These pins should not be routed out on the user's PCB               ##
+##################################################################################################
+
+##################################################################################################
+##The logic of this pin is used internally to drive a BUFR in the column. This chosen pin must  ##
+##be a clock pin capable of spanning to all of the banks containing data bytes in the particular##
+##column. That is, all byte groups must be within +/- 1 bank of this pin. This pin cannot be    ##
+##used for other functions and should not be connected externally. If a different pin is chosen,##
+##he corresponding LOC constraint must also be changed.                                         ##
+##################################################################################################
+
+CONFIG PROHIBIT = C29,M12;
+
+######################################################################################
+##Place RSYNC OSERDES and IODELAY:                                                  ##
+######################################################################################
+
+##Site: C29 -- Bank 25
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_loop_col1.u_oserdes_rsync"
+  LOC = "OLOGIC_X1Y139";
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_loop_col1.u_odelay_rsync"
+  LOC = "IODELAY_X1Y139";
+
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_loop_col1.u_bufr_rsync"
+  LOC = "BUFR_X1Y6";
+
+##Site: M12 -- Bank 35
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_loop_col0.u_oserdes_rsync"
+  LOC = "OLOGIC_X2Y139";
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_loop_col0.u_odelay_rsync"
+  LOC = "IODELAY_X2Y139";
+
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_loop_col0.u_bufr_rsync"
+  LOC = "BUFR_X2Y6";
+
+##################################################################################################
+##The logic of this pin is used internally to drive a BUFIO for the byte group. Any clock       ##
+##capable pin in the same bank as the data byte group (DQS, DQ, DM if used) can be used for     ##
+##this pin. This pin cannot be used for other functions and should not be connected externally. ##
+##If a different pin is chosen, the corresponding LOC constraint must also be changed.          ##
+##################################################################################################
+
+CONFIG PROHIBIT = B20,C13,C28,D24,F21,F25,K14,L13;
+
+######################################################################################
+##Place CPT OSERDES and IODELAY:                                                    ##
+######################################################################################
+
+##Site: C13 -- Bank 35
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*0*u_oserdes_cpt"
+  LOC = "OLOGIC_X2Y137";
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*0*u_odelay_cpt"
+  LOC = "IODELAY_X2Y137";
+
+##Site: L13 -- Bank 35
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*1*u_oserdes_cpt"
+  LOC = "OLOGIC_X2Y141";
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*1*u_odelay_cpt"
+  LOC = "IODELAY_X2Y141";
+
+##Site: K14 -- Bank 35
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*2*u_oserdes_cpt"
+  LOC = "OLOGIC_X2Y143";
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*2*u_odelay_cpt"
+  LOC = "IODELAY_X2Y143";
+
+##Site: F21 -- Bank 26
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*3*u_oserdes_cpt"
+  LOC = "OLOGIC_X1Y179";
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*3*u_odelay_cpt"
+  LOC = "IODELAY_X1Y179";
+
+##Site: B20 -- Bank 26
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*4*u_oserdes_cpt"
+  LOC = "OLOGIC_X1Y181";
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*4*u_odelay_cpt"
+  LOC = "IODELAY_X1Y181";
+
+##Site: F25 -- Bank 25
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*5*u_oserdes_cpt"
+  LOC = "OLOGIC_X1Y137";
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*5*u_odelay_cpt"
+  LOC = "IODELAY_X1Y137";
+
+##Site: C28 -- Bank 25
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*6*u_oserdes_cpt"
+  LOC = "OLOGIC_X1Y141";
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*6*u_odelay_cpt"
+  LOC = "IODELAY_X1Y141";
+
+##Site: D24 -- Bank 25
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*7*u_oserdes_cpt"
+  LOC = "OLOGIC_X1Y143";
+INST "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_read/u_phy_rdclk_gen/gen_ck_cpt*7*u_odelay_cpt"
+  LOC = "IODELAY_X1Y143";
+
+
+######################################################################################
+## MMCM_ADV CONSTRAINTS                                                             ##
+######################################################################################
+
+INST "ddr3ctrl/u_infrastructure/u_mmcm_adv"      LOC = "MMCM_ADV_X0Y8"; #Banks 16, 26, 36
+
+
+
+###########################################################################
+##  ML605 additions
+###########################################################################
+#NET  "pll_lock"                 IOSTANDARD = LVCMOS25;
+#NET  "heartbeat"                IOSTANDARD = LVCMOS25;
+
+#NET  "heartbeat"                LOC = "AC24";   # ML605 GPIO LED 1
+#NET  "pll_lock"                 LOC = "AC22" ;  # ML605 GPIO LED 0
+
+
+NET "address(0)"                      LOC = "AL8";    ## 29 on U4, A1 on U27
+NET "address(1)"                      LOC = "AK8";    ## 25 on U4, B1 on U27
+NET "address(2)"                      LOC = "AC9";    ## 24 on U4, C1 on U27
+NET "address(3)"                      LOC = "AD10";   ## 23 on U4, D1 on U27
+NET "address(4)"                      LOC = "C8";     ## 22 on U4, D2 on U27
+NET "address(5)"                      LOC = "B8";     ## 21 on U4, A2 on U27
+NET "address(6)"                      LOC = "E9";     ## 20 on U4, C2 on U27
+NET "address(7)"                      LOC = "E8";     ## 19 on U4, A3 on U27
+NET "address(8)"                      LOC = "A8";     ## 8  on U4, B3 on U27
+NET "address(9)"                      LOC = "A9";     ## 7  on U4, C3 on U27
+NET "address(10)"                     LOC = "D9";     ## 6  on U4, D3 on U27
+NET "address(11)"                     LOC = "C9";     ## 5  on U4, C4 on U27
+NET "address(12)"                     LOC = "D10";    ## 4  on U4, A5 on U27
+NET "address(13)"                     LOC = "C10";    ## 3  on U4, B5 on U27
+NET "address(14)"                     LOC = "F10";    ## 2  on U4, C5 on U27
+NET "address(15)"                     LOC = "F9";     ## 1  on U4, D7 on U27
+NET "address(16)"                     LOC = "AH8";    ## 55 on U4, D8 on U27
+NET "address(17)"                     LOC = "AG8";    ## 18 on U4, A7 on U27
+NET "address(18)"                     LOC = "AP9";    ## 17 on U4, B7 on U27
+NET "address(19)"                     LOC = "AN9";    ## 16 on U4, C7 on U27
+NET "address(20)"                     LOC = "AF10";   ## 11 on U4, C8 on U27
+NET "address(21)"                     LOC = "AF9";    ## 10 on U4, A8 on U27
+NET "address(22)"                     LOC = "AL9";    ## 9  on U4, G1 on U27
+NET "address(23)"                     LOC = "AA23";   ## 26 on U4
+NET "data(0)"                      LOC = "AF24";   ## 34 on U4, F2 on U27
+NET "data(1)"                      LOC = "AF25";   ## 36 on U4, E2 on U27
+NET "data(2)"                      LOC = "W24";    ## 39 on U4, G3 on U27
+NET "data(3)"                      LOC = "V24";    ## 41 on U4, E4 on U27
+NET "data(4)"                      LOC = "H24";    ## 47 on U4, E5 on U27
+NET "data(5)"                      LOC = "H25";    ## 49 on U4, G5 on U27
+NET "data(6)"                      LOC = "P24";    ## 51 on U4, G6 on U27
+NET "data(7)"                      LOC = "R24";    ## 53 on U4, H7 on U27
+NET "data(8)"                      LOC = "G23";    ## 35 on U4, E1 on U27
+NET "data(9)"                      LOC = "H23";    ## 37 on U4, E3 on U27
+NET "data(10)"                     LOC = "N24";    ## 40 on U4, F3 on U27
+NET "data(11)"                     LOC = "N23";    ## 42 on U4, F4 on U27
+NET "data(12)"                     LOC = "F23";    ## 48 on U4, F5 on U27
+NET "data(13)"                     LOC = "F24";    ## 50 on U4, H5 on U27
+NET "data(14)"                     LOC = "L24";    ## 52 on U4, G7 on U27
+NET "data(15)"                     LOC = "M23";    ## 54 on U4, E7 on U27
+#NET "FLASH_WAIT"                    LOC = "J26";    ## 56 on U4
+NET "writen"                    LOC = "AF23";   ## 14 on U4, G8 on U27
+NET "oen"                    LOC = "AA24";   ## 32 on U4, F8 on U27
+#NET "FPGA_CCLK"                     LOC = "K8";     ##           F1 on U27
+NET "alatch"                 LOC = "AC23";   ##           H1 on U27
+NET "romsn"                    LOC = "Y24";    ## 30 on U4, B4 on U27 (U10 and switch S2.2 setting select either U4 or U27)
+##
+
+NET "erx_col"                       LOC = "AK13";   ## 114 on U80
+NET "erx_crs"                       LOC = "AL13";   ## 115 on U80
+NET "emdint"                       LOC = "AH14";   ## 32  on U80
+NET "emdc"                       LOC = "AP14";   ## 35  on U80
+NET "emdio"                      LOC = "AN14";   ## 33  on U80
+NET "erstn"                     LOC = "AH13";   ## 36  on U80
+NET "erx_clk"                     LOC = "AP11";   ## 7   on U80
+NET "erx_dv"                LOC = "AM13";   ## 4   on U80
+NET "erxd(0)"                      LOC = "AN13";   ## 3   on U80
+NET "erxd(1)"                      LOC = "AF14";   ## 128 on U80
+NET "erxd(2)"                      LOC = "AE14";   ## 126 on U80
+NET "erxd(3)"                      LOC = "AN12";   ## 125 on U80
+NET "erxd(4)"                      LOC = "AM12";   ## 124 on U80
+NET "erxd(5)"                      LOC = "AD11";   ## 123 on U80
+NET "erxd(6)"                      LOC = "AC12";   ## 121 on U80
+NET "erxd(7)"                      LOC = "AC13";   ## 120 on U80
+NET "erx_er"                      LOC = "AG12";   ## 9   on U80
+NET "etx_clk"                     LOC = "AD12";   ## 10  on U80
+NET "etx_en"                LOC = "AJ10";   ## 16  on U80
+NET "egtx_clk"                LOC = "AH12";   ## 14  on U80
+NET "etxd(0)"                      LOC = "AM11";   ## 18  on U80
+NET "etxd(1)"                      LOC = "AL11";   ## 19  on U80
+NET "etxd(2)"                      LOC = "AG10";   ## 20  on U80
+NET "etxd(3)"                      LOC = "AG11";   ## 24  on U80
+NET "etxd(4)"                      LOC = "AL10";   ## 25  on U80
+NET "etxd(5)"                      LOC = "AM10";   ## 26  on U80
+NET "etxd(6)"                      LOC = "AE11";   ## 28  on U80
+NET "etxd(7)"                      LOC = "AF11";   ## 29  on U80
+NET "etx_er"                      LOC = "AH10";   ## 13  on U80
+
+NET "dsurx"                      LOC = "J24";    ## 24  on U34
+NET "dsutx"                      LOC = "J25";    ## 25  on U34
+
+#NET "GPIO_DIP_SW1"                  LOC = "D22";    ## 1   on SW1 DIP switch (active-high)
+#NET "GPIO_DIP_SW2"                  LOC = "C22";    ## 2   on SW1 DIP switch (active-high)
+#NET "GPIO_DIP_SW3"                  LOC = "L21";    ## 3   on SW1 DIP switch (active-high)
+#NET "GPIO_DIP_SW4"                  LOC = "L20";    ## 4   on SW1 DIP switch (active-high)
+#NET "GPIO_DIP_SW5"                  LOC = "C18";    ## 5   on SW1 DIP switch (active-high)
+#NET "dsubre"                  LOC = "B18";    ## 6   on SW1 DIP switch (active-high)
+#NET "GPIO_DIP_SW7"                  LOC = "K22";    ## 7   on SW1 DIP switch (active-high)
+#NET "GPIO_DIP_SW8"                  LOC = "K21";    ## 8   on SW1 DIP switch (active-high)
+##
+
+NET "led(0)"                    LOC = "AC22";   ## 2   on LED DS12, 1 on J62
+NET "led(1)"                    LOC = "AC24";   ## 2   on LED DS11, 2 on J62
+NET "led(2)"                    LOC = "AE22";   ## 2   on LED DS9,  3 on J62
+NET "led(3)"                    LOC = "AE23";   ## 2   on LED DS10, 4 on J62
+NET "led(4)"                    LOC = "AB23";   ## 2   on LED DS15, 5 on J62
+NET "led(5)"                    LOC = "AG23";   ## 2   on LED DS14, 6 on J62
+NET "led(6)"                    LOC = "AE24";   ## 2   on LED DS22, 6 on J62
+NET "led(7)"                    LOC = "AD24";   ## 2   on LED DS21, 6 on J62
+
+NET "dvi_iic_scl"                   LOC = "AN10";   ## 2   on Q5, 15 on U38
+NET "iic_scl_main"               LOC = "AK9";    ## 2   on Q19
+#NET "IIC_SCL_SFP"                   LOC = "AA34";   ## 2   on Q23
+NET "dvi_iic_sda"                   LOC = "AP10";   ## 2   on Q6, 14 on U38
+NET "iic_sda_main"               LOC = "AE9";    ## 2   on Q20
+#NET "IIC_SDA_SFP"                   LOC = "AA33";   ## 2   on Q21
+
+NET "tft_lcd_data(0)"                        LOC = "AJ19";   ## 63 on U38 (thru series R111 47.5 ohm)
+NET "tft_lcd_data(1)"                        LOC = "AH19";   ## 62 on U38 (thru series R110 47.5 ohm)
+NET "tft_lcd_data(2)"                        LOC = "AM17";   ## 61 on U38 (thru series R109 47.5 ohm)
+NET "tft_lcd_data(3)"                        LOC = "AM16";   ## 60 on U38 (thru series R108 47.5 ohm)
+NET "tft_lcd_data(4)"                        LOC = "AD17";   ## 59 on U38 (thru series R107 47.5 ohm)
+NET "tft_lcd_data(5)"                        LOC = "AE17";   ## 58 on U38 (thru series R106 47.5 ohm)
+NET "tft_lcd_data(6)"                        LOC = "AK18";   ## 55 on U38 (thru series R105 47.5 ohm)
+NET "tft_lcd_data(7)"                        LOC = "AK17";   ## 54 on U38 (thru series R104 47.5 ohm)
+NET "tft_lcd_data(8)"                        LOC = "AE18";   ## 53 on U38 (thru series R103 47.5 ohm)
+NET "tft_lcd_data(9)"                        LOC = "AF18";   ## 52 on U38 (thru series R102 47.5 ohm)
+NET "tft_lcd_data(10)"                       LOC = "AL16";   ## 51 on U38 (thru series R101 47.5 ohm)
+NET "tft_lcd_data(11)"                       LOC = "AK16";   ## 50 on U38 (thru series R100 47.5 ohm)
+NET "tft_lcd_de"                        LOC = "AD16";   ## 2  on U38 (thru series R112 47.5 ohm)
+#NET "DVI_GPIO1_FMC_C2M_PG_LS"       LOC = "K9";     ## 18 on U32 (not wired to U38)
+NET "tft_lcd_hsync"                         LOC = "AN17";   ## 4  on U38 (thru series R113 47.5 ohm)
+NET "tft_lcd_reset_b"                LOC = "AP17";   ## 2  on U32 (DVI_RESET_B pin 13 on U38)
+NET "tft_lcd_vsync"                         LOC = "AD15";   ## 5  on U38 (thru series R114 47.5 ohm)
+NET "tft_lcd_clk_n"                    LOC = "AC17";   ## 56 on U38
+NET "tft_lcd_clk_p"                    LOC = "AC18";   ## 57 on U38
+
+#NET "SYSACE_CFGTDI"                 LOC = "AC8";    ## 81  on U19
+NET "sysace_d(0)"                     LOC = "AM15";   ## 66  on U19
+NET "sysace_d(1)"                     LOC = "AJ17";   ## 65  on U19
+NET "sysace_d(2)"                     LOC = "AJ16";   ## 63  on U19
+NET "sysace_d(3)"                     LOC = "AP16";   ## 62  on U19
+NET "sysace_d(4)"                     LOC = "AG16";   ## 61  on U19
+NET "sysace_d(5)"                     LOC = "AH15";   ## 60  on U19
+NET "sysace_d(6)"                     LOC = "AF16";   ## 59  on U19
+NET "sysace_d(7)"                     LOC = "AN15";   ## 58  on U19
+NET "sysace_mpa(0)"                  LOC = "AC15";   ## 70  on U19
+NET "sysace_mpa(1)"                  LOC = "AP15";   ## 69  on U19
+NET "sysace_mpa(2)"                  LOC = "AG17";   ## 68  on U19
+NET "sysace_mpa(3)"                  LOC = "AH17";   ## 67  on U19
+NET "sysace_mpa(4)"                  LOC = "AG15";   ## 45  on U19
+NET "sysace_mpa(5)"                  LOC = "AF15";   ## 44  on U19
+NET "sysace_mpa(6)"                  LOC = "AK14";   ## 43  on U19
+#NET "SYSACE_MPBRDY"                 LOC = "AJ15";   ## 39  on U19
+NET "sysace_mpce"                   LOC = "AJ14";   ## 42  on U19
+NET "sysace_mpirq"                  LOC = "L9";     ## 41  on U19
+NET "sysace_mpoe"                   LOC = "AL15";   ## 77  on U19
+NET "sysace_mpwe"                   LOC = "AL14";   ## 76  on U19
+NET "clk_33"              LOC = "AE16";   ## 93  on U19
 NET "clk_33" PERIOD = 30.000 ;
 OFFSET = IN : 20.000 : BEFORE clk_33 ;
 OFFSET = OUT : 20.000 : AFTER clk_33 ;
@@ -585,29 +583,89 @@ OFFSET = OUT : 12.000 : AFTER gmiiclk_p;
 
 INST "uddr3ctrl/_infrastructure/u_mmcm_adv"      LOC = "MMCM_ADV_X0Y8"; #Banks 16, 26, 36
 
-# Constrain BUFR clocks used to synchronize data from IOB to fabric logic
-# Note that ISE cannot infer this from other PERIOD constraints because
-# of the use of OSERDES blocks in the BUFR clock generation path
-NET "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/clk_rsync[?]" TNM_NET = TNM_clk_rsync_xst;
-TIMESPEC "TS_clk_rsync_xst" = PERIOD "TNM_clk_rsync_xst" 5 ns;
-
-# Paths between DQ/DQS ISERDES.Q outputs and CLB flops clocked by falling 
-# edge of BUFR will by design only be used if DYNCLKDIVSEL is asserted for 
-# that particular flop. Mark this path as being a full-cycle, rather than 
-# a half cycle path for timing purposes. NOTE: This constraint forces full-
-# cycle timing to be applied globally for all rising->falling edge paths 
-# in all resynchronizaton clock domains. If the user had modified the logic
-# in the resync clock domain such that other rising->falling edge paths 
-# exist, then constraint below should be modified to utilize pattern 
-# matching to specific affect only the DQ/DQS ISERDES.Q outputs
-TIMEGRP "TG_clk_rsync_rise_xst" = RISING  "TNM_clk_rsync_xst";
-TIMEGRP "TG_clk_rsync_fall_xst" = FALLING "TNM_clk_rsync_xst";
-TIMESPEC "TS_clk_rsync_rise_to_fall_xst" = 
-  FROM "TG_clk_rsync_rise_xst" TO "TG_clk_rsync_fall_xst" "TS_sys_clk" * 2;
-
-# Signal to select between controller and physical layer signals. Four divided by two clock
-# cycles (8 memory clock cycles) are provided by design for the signal to settle down.
-# Used only by the phy modules.
-#INST "u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_init/u_ff_phy_init_data_sel" TNM = "TNM_PHY_INIT_SEL";
-#TIMESPEC "TS_MC_PHY_INIT_SEL" = FROM "TNM_PHY_INIT_SEL" TO FFS = 10 ns;  ## = "2.5ns * 4" ML605 single clock
+# Constrain BUFR clocks used to synchronize data from IOB to fabric logic
+# Note that ISE cannot infer this from other PERIOD constraints because
+# of the use of OSERDES blocks in the BUFR clock generation path
+NET "ddr3ctrl/u_memc_ui_top/u_mem_intfc/phy_top0/clk_rsync[?]" TNM_NET = TNM_clk_rsync_xst;
+TIMESPEC "TS_clk_rsync_xst" = PERIOD "TNM_clk_rsync_xst" 5 ns;
+
+# Paths between DQ/DQS ISERDES.Q outputs and CLB flops clocked by falling 
+# edge of BUFR will by design only be used if DYNCLKDIVSEL is asserted for 
+# that particular flop. Mark this path as being a full-cycle, rather than 
+# a half cycle path for timing purposes. NOTE: This constraint forces full-
+# cycle timing to be applied globally for all rising->falling edge paths 
+# in all resynchronizaton clock domains. If the user had modified the logic
+# in the resync clock domain such that other rising->falling edge paths 
+# exist, then constraint below should be modified to utilize pattern 
+# matching to specific affect only the DQ/DQS ISERDES.Q outputs
+TIMEGRP "TG_clk_rsync_rise_xst" = RISING  "TNM_clk_rsync_xst";
+TIMEGRP "TG_clk_rsync_fall_xst" = FALLING "TNM_clk_rsync_xst";
+TIMESPEC "TS_clk_rsync_rise_to_fall_xst" = 
+  FROM "TG_clk_rsync_rise_xst" TO "TG_clk_rsync_fall_xst" "TS_sys_clk" * 2;
+
+# Signal to select between controller and physical layer signals. Four divided by two clock
+# cycles (8 memory clock cycles) are provided by design for the signal to settle down.
+# Used only by the phy modules.
+#INST "u_memc_ui_top/u_mem_intfc/phy_top0/u_phy_init/u_ff_phy_init_data_sel" TNM = "TNM_PHY_INIT_SEL";
+#TIMESPEC "TS_MC_PHY_INIT_SEL" = FROM "TNM_PHY_INIT_SEL" TO FFS = 10 ns;  ## = "2.5ns * 4" ML605 single clock
+
+
+
+######################################################################################
+## DDR-PHY TIMEOUT BLOCK CONSTRAINTS                                                ##
+######################################################################################
+
+# Ignore timing on the following two signals. They cross clock domains, but are
+# treated as "external" asynchronous signals, so their timing is irrelevant.
+NET "reset_block/lockTimeoutRst" TIG;
+NET "reset_block/lockTimeout" TIG;
+
+
+
+######################################################################################
+## PCI-express signals (copied from reference project)                              ##
+######################################################################################
+#------------------------
+# Clock and Reset Pinout
+#------------------------
+NET "pcie_ref_clk" TNM_NET = "SYSCLK" ;
+NET "*/pcie_clocking_i/clk_125" TNM_NET = "CLK_125" ;
+NET "*/TxOutClk_bufg" TNM_NET = "TXOUTCLKBUFG";
+
+TIMESPEC "TS_SYSCLK"  = PERIOD "SYSCLK" 250.00 MHz HIGH 50 % ;
+TIMESPEC "TS_CLK_125" = PERIOD "CLK_125" TS_SYSCLK*0.5 HIGH 50 %; # PRIORITY 100 ;
+TIMESPEC "TS_TXOUTCLKBUFG"  = PERIOD "TXOUTCLKBUFG" 250 MHz HIGH 50 %; # PRIORITY 100 ;
+
+NET "sys_reset_n" TIG;
+PIN "*/trn_reset_n_int_i.CLR" TIG ;
+PIN "*/trn_reset_n_i.CLR" TIG ;
+PIN "*/pcie_clocking_i/mmcm_adv_i.RST" TIG ;
+
+#TIMESPEC "TS_TRNLNKUPN" = FROM FFS(*) TO FFS(trn_lnk_up_n_int_i) 4 ns;
+#TIMESPEC "TS_RESETN" = FROM FFS(*) TO FFS(trn_reset_n_i) 4 ns;
+TIMESPEC "TS_RESETN" = FROM FFS(*) TO FFS(user_reset) 8 ns;
+
+
+#-----------------------------------
+# PCIe Transceiver & Core Locations
+#-----------------------------------
+
+# PCIe Block Placement
+INST "*/pcie_2_0_i/pcie_block_i" LOC = PCIE_X0Y1;
+
+INST "*/pcie_2_0_i/pcie_gt_i/gtx_v6_i/no_of_lanes.GTXD[0].GTX" LOC = GTXE1_X0Y15;
+INST "*/pcie_2_0_i/pcie_gt_i/gtx_v6_i/no_of_lanes.GTXD[1].GTX" LOC = GTXE1_X0Y14;
+INST "*/pcie_2_0_i/pcie_gt_i/gtx_v6_i/no_of_lanes.GTXD[2].GTX" LOC = GTXE1_X0Y13;
+INST "*/pcie_2_0_i/pcie_gt_i/gtx_v6_i/no_of_lanes.GTXD[3].GTX" LOC = GTXE1_X0Y12;
+
+#------------------------
+# Clock and Reset Pinout
+#------------------------
+
+NET  sys_reset_n           LOC  = AE13 | IOSTANDARD = LVCMOS25 | NODELAY;
+
+# 250 MHz Reference Clock
+INST "pcie_refclk_ibuf" LOC = IBUFDS_GTXE1_X0Y4; # Implies pinout
 
+# MMCM Placment. This constraint selects the MMCM Placement
+INST "*/pcie_clocking_i/mmcm_adv_i" LOC = MMCM_ADV_X0Y7;
diff -rupN '--exclude=ram.srec' ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/leon3mp.vhd work/leon3mp.vhd
--- ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/leon3mp.vhd	2014-04-16 16:51:31.000000000 +0200
+++ work/leon3mp.vhd	2015-11-05 12:42:32.882494422 +0100
@@ -18,7 +18,7 @@
 --
 --  You should have received a copy of the GNU General Public License
 --  along with this program; if not, write to the Free Software
---  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA 
+--  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 ------------------------------------------------------------------------------
 
 library ieee;
@@ -49,6 +49,15 @@ use work.pcie.all;
 -- pragma translate_off
 use gaisler.sim.all;
 -- pragma translate_on
+library rvex;
+use rvex.common_pkg.all;
+use rvex.bus_pkg.all;
+use rvex.bus_addrConv_pkg.all;
+use rvex.core_pkg.all;
+use rvex.cache_pkg.all;
+use rvex.rvsys_grlib_pkg.all;
+library unisim;
+use unisim.vcomponents.all;
 
 entity leon3mp is
   generic (
@@ -67,12 +76,12 @@ entity leon3mp is
     clk_ref_n     : in    std_logic;
 
     -- PROM interface
-    address   : out   std_logic_vector(23 downto 0);
-    data      : inout std_logic_vector(15 downto 0);
-    romsn     : out   std_ulogic;
-    oen       : out   std_ulogic;
-    writen    : out   std_ulogic;
-    alatch    : out   std_ulogic;
+    address   : out   std_logic_vector(23 downto 0) := (others => '0');
+    data      : inout std_logic_vector(15 downto 0) := (others => 'Z');
+    romsn     : out   std_ulogic := '0';
+    oen       : out   std_ulogic := '0';
+    writen    : out   std_ulogic := '0';
+    alatch    : out   std_ulogic := '0';
 
     -- DDR3 memory
     ddr3_dq       : inout std_logic_vector(DQ_WIDTH-1 downto 0);
@@ -92,7 +101,9 @@ entity leon3mp is
     ddr3_ck_n     : out   std_logic_vector(CK_WIDTH-1 downto 0);
 
     -- Debug support unit
-    dsubre    : in    std_ulogic;       -- Debug Unit break (connect to button)
+    --dsubre    : in    std_ulogic;       -- Debug Unit break (connect to button)
+    -- Pin removed because we're not using the LEON DSU (much less the physical
+    -- switches) and it was giving I/O standard conflicts with the DD3 signals.
 
     -- AHB Uart
     dsurx     : in    std_ulogic;
@@ -150,7 +161,7 @@ entity leon3mp is
 
 
     -- Output signals to LEDs
-    led       : out   std_logic_vector(6 downto 0)
+    led       : out   std_logic_vector(7 downto 0) := (others => '0')
     );
 end;
 
@@ -179,8 +190,8 @@ architecture rtl of leon3mp is
   signal irqi : irq_in_vector(0 to CFG_NCPU-1);
   signal irqo : irq_out_vector(0 to CFG_NCPU-1);
 
-  signal dbgi : l3_debug_in_vector(0 to CFG_NCPU-1);
-  signal dbgo : l3_debug_out_vector(0 to CFG_NCPU-1);
+  signal dbgi : l3_debug_in_vector(0 to CFG_NLEON-1);
+  signal dbgo : l3_debug_out_vector(0 to CFG_NLEON-1);
 
   signal dsui : dsu_in_type;
   signal dsuo : dsu_out_type;
@@ -204,6 +215,10 @@ architecture rtl of leon3mp is
   signal phy_init_done : std_logic;
   signal lerrorn        : std_logic;
 
+  -- PCIe reset signal
+  signal sys_reset_n_c   : std_logic;
+  signal sys_reset_n_buf : std_logic;
+
   -- RS232 APB Uart
   signal rxd1 : std_logic;
   signal txd1 : std_logic;
@@ -246,8 +261,35 @@ architecture rtl of leon3mp is
   constant CPU_FREQ   : integer := VCO_FREQ / CFG_MIG_CLK4;  -- cpu frequency in KHz
   constant I2C_FILTER : integer := (CPU_FREQ*5+50000)/100000+1;
 
+  -- rvex bus master interface.
+  signal rvbmo  : bus_mst2slv_type;
+  signal rvbmi  : bus_slv2mst_type;
+
+  -- rvex bus slave interfaces.
+  constant N_RVB_SLAVES : integer := CFG_NRVEX + CFG_AHB_UART*CFG_AHB_UART_RVEX;
+  signal rvbsi  : bus_mst2slv_array(0 to N_RVB_SLAVES - 1);
+  signal rvbso  : bus_slv2mst_array(0 to N_RVB_SLAVES - 1);
+
+  -- Run control interfaces
+  signal rctrl2rv : rvex_rctrl2rv_array(CFG_NRVEX-1 downto 0);
+  signal rv2rctrl : rvex_rv2rctrl_array(CFG_NRVEX-1 downto 0);
+
+  signal pcie_rctrl2rv : rvex_rctrl2rv_array(CFG_NRVEX-1 downto 0);
+  signal irq_rctrl2rv  : rvex_rctrl2rv_array(CFG_NRVEX-1 downto 0);
+
 begin
 
+
+----------------------------------------------------------------------
+---  PCIe reset input buffer -----------------------------------------
+----------------------------------------------------------------------
+  perst_n_ibuf : IBUF
+    port map(
+      I     => sys_reset_n,
+      O     => sys_reset_n_c
+    );
+  sys_reset_n_buf <= sys_reset_n_c;
+
 ----------------------------------------------------------------------
 ---  Reset and Clock generation  -------------------------------------
 ----------------------------------------------------------------------
@@ -258,9 +300,74 @@ begin
   erstn <= rstn;
 
   -- Glitch free reset that can be used for the Eth Phy and flash memory
+  reset_block: block is
 
-  rst0 : rstgen generic map (acthigh => 1)
-    port map (reset, clkm, lock, rstn, rstraw);
+    signal lockTimeoutRst   : std_logic;
+    signal lockTimeoutA     : unsigned(12 downto 0) := (others => '0');
+    signal lockTimeoutB     : unsigned(13 downto 0) := (others => '0');
+    signal lockTimeout      : std_logic;
+    signal resetOrTimeout   : std_logic;
+
+    -- lockTimeoutRst and lockTimeout cross two independent clock domains.
+    -- Their timing is completely irrelevant because they're treated as
+    -- asynchronous signals, so we need to disable timing checking for these
+    -- signals. To do that, we can't have them be optimized away, so we need
+    -- to attach the KEEP property to them. The actual TIG constraint has to
+    -- be placed in the UCF file.
+    attribute KEEP                    : string;
+    attribute KEEP of lockTimeoutRst  : signal is "TRUE";
+    attribute KEEP of lockTimeout     : signal is "TRUE";
+
+  begin
+
+    -- Generate reset signal for the clock lock/PHY init timeout.
+    lockTimeoutRst <= reset or lock;
+
+    -- Generate the lock/PHY timeout counters. Use the clkace 33 MHz clock
+    -- signal for this instead of clkm, because clkace always runs, whereas
+    -- clkm comes from an MMCM in the MIG, which is reset when we generate
+    -- a timeout.
+    lock_timeout_proc: process (clkace) is
+    begin
+      if rising_edge(clkace) then
+        if lockTimeoutRst = '1' then
+          lockTimeoutA  <= (others => '0');
+          lockTimeoutB  <= (others => '0');
+          lockTimeout   <= '0';
+        else
+          if lockTimeoutA(12) = '0' then
+            lockTimeoutA <= lockTimeoutA + 1;
+          else
+            lockTimeoutA <= (others => '0');
+            if lockTimeoutB(13) = '0' then
+              lockTimeoutB <= lockTimeoutB + 1;
+            else
+              lockTimeoutB <= (others => '0');
+            end if;
+          end if;
+          lockTimeout <= lockTimeoutB(12) and lockTimeoutB(11)
+                     and lockTimeoutB(10) and lockTimeoutB(9);
+        end if;
+      end if;
+    end process;
+
+    -- Combine the incoming reset signal with the lock timeout and the PCIe reset signal.
+    resetOrTimeout <= reset or lockTimeout or (not sys_reset_n_buf);
+
+    -- Original reset generator.
+    rst0 : rstgen
+      generic map (
+        acthigh   => 1
+      )
+      port map (
+        rstin     => resetOrTimeout,
+        clk       => clkm,
+        clklock   => lock,
+        rstout    => rstn,
+        rstoutraw => rstraw
+      );
+
+  end block;
 
 ----------------------------------------------------------------------
 ---  AHB CONTROLLER --------------------------------------------------
@@ -269,8 +376,8 @@ begin
   ahb0 : ahbctrl
     generic map (defmast => CFG_DEFMST, split => CFG_SPLIT,
                  rrobin  => CFG_RROBIN, ioaddr => CFG_AHBIO, ioen => 1,
-                 nahbm => CFG_NCPU+CFG_AHB_UART+CFG_AHB_JTAG+CFG_GRETH+CFG_SVGA_ENABLE+CFG_PCIEXP,
-                 nahbs => 9)
+                 nahbm => CFG_NCPU+CFG_AHB_UART+CFG_AHB_JTAG+CFG_GRETH+CFG_SVGA_ENABLE+CFG_PCIEXP+2*CFG_AHB_PCIE,
+                 nahbs => 10)
     port map (rstn, clkm, ahbmi, ahbmo, ahbsi, ahbso);
 
 ----------------------------------------------------------------------
@@ -279,7 +386,7 @@ begin
 
   -- LEON3 processor
   nosh : if CFG_GRFPUSH = 0 generate
-    cpu : for i in 0 to CFG_NCPU-1 generate
+    cpu : for i in 0 to CFG_NLEON-1 generate
       l3ft : if CFG_LEON3FT_EN /= 0 generate
         leon3ft0 : leon3ft		-- LEON3 processor
         generic map (i, fabtech, memtech, CFG_NWIN, CFG_DSU, CFG_FPU*(1-CFG_GRFPUSH), CFG_V8,
@@ -287,7 +394,7 @@ begin
 	  CFG_ISETSZ, CFG_ILOCK, CFG_DCEN, CFG_DREPL, CFG_DSETS, CFG_DLINE, CFG_DSETSZ,
 	  CFG_DLOCK, CFG_DSNOOP, CFG_ILRAMEN, CFG_ILRAMSZ, CFG_ILRAMADDR, CFG_DLRAMEN,
           CFG_DLRAMSZ, CFG_DLRAMADDR, CFG_MMUEN, CFG_ITLBNUM, CFG_DTLBNUM, CFG_TLB_TYPE, CFG_TLB_REP,
-          CFG_LDDEL, disas, CFG_ITBSZ, CFG_PWD, CFG_SVT, CFG_RSTADDR, CFG_NCPU-1,
+          CFG_LDDEL, disas, CFG_ITBSZ, CFG_PWD, CFG_SVT, CFG_RSTADDR, CFG_NLEON-1,
 	  CFG_IUFT_EN, CFG_FPUFT_EN, CFG_CACHE_FT_EN, CFG_RF_ERRINJ,
 	  CFG_CACHE_ERRINJ, CFG_DFIXED, CFG_LEON3_NETLIST, CFG_SCAN, CFG_MMU_PAGE)
         port map (clkm, rstn, ahbmi, ahbmo(i), ahbsi, ahbso,
@@ -301,7 +408,7 @@ begin
 	  CFG_ISETSZ, CFG_ILOCK, CFG_DCEN, CFG_DREPL, CFG_DSETS, CFG_DLINE, CFG_DSETSZ,
 	  CFG_DLOCK, CFG_DSNOOP, CFG_ILRAMEN, CFG_ILRAMSZ, CFG_ILRAMADDR, CFG_DLRAMEN,
           CFG_DLRAMSZ, CFG_DLRAMADDR, CFG_MMUEN, CFG_ITLBNUM, CFG_DTLBNUM, CFG_TLB_TYPE, CFG_TLB_REP,
-          CFG_LDDEL, disas, CFG_ITBSZ, CFG_PWD, CFG_SVT, CFG_RSTADDR, CFG_NCPU-1,
+          CFG_LDDEL, disas, CFG_ITBSZ, CFG_PWD, CFG_SVT, CFG_RSTADDR, CFG_NLEON-1,
 	  CFG_DFIXED, CFG_SCAN, CFG_MMU_PAGE)
         port map (clkm, rstn, ahbmi, ahbmo(i), ahbsi, ahbso,
     		irqi(i), irqo(i), dbgi(i), dbgo(i));
@@ -310,7 +417,7 @@ begin
   end generate;
 
   sh : if CFG_GRFPUSH = 1 generate
-    cpu : for i in 0 to CFG_NCPU-1 generate
+    cpu : for i in 0 to CFG_NLEON-1 generate
       l3ft : if CFG_LEON3FT_EN /= 0 generate
         leon3ft0 : leon3ftsh		-- LEON3 processor
         generic map (i, fabtech, memtech, CFG_NWIN, CFG_DSU, CFG_FPU, CFG_V8,
@@ -318,7 +425,7 @@ begin
 	  CFG_ISETSZ, CFG_ILOCK, CFG_DCEN, CFG_DREPL, CFG_DSETS, CFG_DLINE, CFG_DSETSZ,
 	  CFG_DLOCK, CFG_DSNOOP, CFG_ILRAMEN, CFG_ILRAMSZ, CFG_ILRAMADDR, CFG_DLRAMEN,
           CFG_DLRAMSZ, CFG_DLRAMADDR, CFG_MMUEN, CFG_ITLBNUM, CFG_DTLBNUM, CFG_TLB_TYPE, CFG_TLB_REP,
-          CFG_LDDEL, disas, CFG_ITBSZ, CFG_PWD, CFG_SVT, CFG_RSTADDR, CFG_NCPU-1,
+          CFG_LDDEL, disas, CFG_ITBSZ, CFG_PWD, CFG_SVT, CFG_RSTADDR, CFG_NLEON-1,
 	  CFG_IUFT_EN, CFG_FPUFT_EN, CFG_CACHE_FT_EN, CFG_RF_ERRINJ,
 	  CFG_CACHE_ERRINJ, CFG_DFIXED, CFG_LEON3_NETLIST, CFG_SCAN, CFG_MMU_PAGE)
         port map (clkm, rstn, ahbmi, ahbmo(i), ahbsi, ahbso,
@@ -332,30 +439,36 @@ begin
 	  CFG_ISETSZ, CFG_ILOCK, CFG_DCEN, CFG_DREPL, CFG_DSETS, CFG_DLINE, CFG_DSETSZ,
 	  CFG_DLOCK, CFG_DSNOOP, CFG_ILRAMEN, CFG_ILRAMSZ, CFG_ILRAMADDR, CFG_DLRAMEN,
           CFG_DLRAMSZ, CFG_DLRAMADDR, CFG_MMUEN, CFG_ITLBNUM, CFG_DTLBNUM, CFG_TLB_TYPE, CFG_TLB_REP,
-          CFG_LDDEL, disas, CFG_ITBSZ, CFG_PWD, CFG_SVT, CFG_RSTADDR, CFG_NCPU-1,
+          CFG_LDDEL, disas, CFG_ITBSZ, CFG_PWD, CFG_SVT, CFG_RSTADDR, CFG_NLEON-1,
 	  CFG_DFIXED, CFG_SCAN, CFG_MMU_PAGE)
         port map (clkm, rstn, ahbmi, ahbmo(i), ahbsi, ahbso,
     		irqi(i), irqo(i), dbgi(i), dbgo(i), fpi(i), fpo(i));
       end generate;
     end generate;
 
-    grfpush0 : grfpushwx generic map ((CFG_FPU-1), CFG_NCPU, fabtech)
+    grfpush0 : grfpushwx generic map ((CFG_FPU-1), CFG_NLEON, fabtech)
     port map (clkm, rstn, fpi, fpo);
 
   end generate;
 
-  lerrorn <= dbgo(0).error and rstn;
+  error_leon: if CFG_NLEON /= 0 generate
+    lerrorn <= dbgo(0).error and rstn;
+  end generate;
+  error_no_leon: if CFG_NLEON = 0 generate
+    lerrorn <= rstn;
+  end generate;
   error_pad : odpad generic map (level => cmos, voltage => x25v, tech => padtech) port map (errorn, lerrorn);
 
-  dsugen : if CFG_DSU = 1 generate
+  dsugen : if CFG_DSU = 1 and CFG_NLEON /= 0 generate
     -- LEON3 Debug Support Unit
     dsugen : if CFG_DSU = 1 generate
       dsu0 : dsu3
         generic map (hindex => 2, haddr => 16#900#, hmask => 16#F00#,
-                     ncpu   => CFG_NCPU, tbits => 30, tech => memtech, irq => 0, kbytes => CFG_ATBSZ)
+                     ncpu   => CFG_NLEON, tbits => 30, tech => memtech, irq => 0, kbytes => CFG_ATBSZ)
         port map (rstn, clkm, ahbmi, ahbsi, ahbso(2), dbgo, dbgi, dsui, dsuo);
 
-      dsubre_pad : inpad generic map (level => cmos, voltage => x15v, tech  => padtech) port map (dsubre, dsui.break);
+      --dsubre_pad : inpad generic map (level => cmos, voltage => x15v, tech  => padtech) port map (dsubre, dsui.break);
+      dsui.break <= '0';
 
       dsui.enable <= '1';
       led(2) <= dsuo.active;
@@ -366,10 +479,73 @@ begin
   end generate;
 
   -- Debug UART
-  dcomgen : if CFG_AHB_UART = 1 generate
+  dcomgen : if CFG_AHB_UART = 1 and CFG_AHB_UART_RVEX = 0 generate
     dcom0 : ahbuart
       generic map (hindex => CFG_NCPU, pindex => 4, paddr => 7)
       port map (rstn, clkm, dui, duo, apbi, apbo(4), ahbmi, ahbmo(CFG_NCPU));
+  end generate;
+  rvuartgen : if CFG_AHB_UART = 1 and CFG_AHB_UART_RVEX = 1 generate
+    signal reset        : std_logic;
+    signal clk          : std_logic;
+    signal rx           : std_logic;
+    signal tx           : std_logic;
+    signal uart2dbg_bus : bus_mst2slv_type;
+    signal dbg2uart_bus : bus_slv2mst_type;
+    signal irq          : std_logic;
+  begin
+
+    reset <= not rstn;
+    clk <= clkm;
+    rx <= dui.rxd;
+    duo.txd <= tx;
+
+    -- Instantiate the AHB master for the debug UART.
+    rvex_uart_mst_inst: entity rvex.bus2ahb
+      generic map (
+        AHB_MASTER_INDEX  => CFG_NCPU,
+        AHB_VENDOR_ID     => VENDOR_TUDELFT,
+        AHB_DEVICE_ID     => TUDELFT_UART
+      )
+      port map (
+        reset             => reset,
+        clk               => clk,
+        bus2bridge        => uart2dbg_bus,
+        bridge2bus        => dbg2uart_bus,
+        bridge2ahb        => ahbmo(CFG_NCPU),
+        ahb2bridge        => ahbmi
+      );
+
+    -- Instantiate the UART.
+    rvex_uart_inst: entity rvex.periph_uart
+      generic map (
+        F_CLK             => real(CPU_FREQ) * 1000.0,
+        F_BAUD            => 115200.0
+      )
+      port map (
+        reset             => reset,
+        clk               => clk,
+        clkEn             => '1',
+        rx                => rx,
+        tx                => tx,
+        bus2uart          => rvbsi(CFG_NRVEX),
+        uart2bus          => rvbso(CFG_NRVEX),
+        irq               => irq,
+        uart2dbg_bus      => uart2dbg_bus,
+        dbg2uart_bus      => dbg2uart_bus
+
+      );
+
+    -- We're only using the APB slot for the interrupt. We use the same
+    -- interrupt index as UART1, which can't coexist with this UART because
+    -- they would have the same external pins.
+    rvex_uart_apb: process (irq) is
+    begin
+      apbo(4) <= apb_none;
+      apbo(4).pirq <= (2 => irq, others => '0');
+    end process;
+
+  end generate;
+  dbguartgen : if CFG_AHB_UART = 1 generate
     dsurx_pad : inpad generic map (level => cmos, voltage => x25v, tech  => padtech) port map (dsurx, dui.rxd);
     dsutx_pad : outpad generic map (level => cmos, voltage => x25v, tech => padtech) port map (dsutx, duo.txd);
     led(0) <= not dui.rxd;
@@ -384,6 +560,239 @@ begin
   end generate;
 
 ----------------------------------------------------------------------
+---  r-VEX processor -------------------------------------------------
+----------------------------------------------------------------------
+
+  -- Check rvex configuration.
+  --assert CFG_RVEX_CFG.core.numLaneGroupsLog2 = CFG_RVEX_CFG.core.numContextsLog2
+  --  report "numLaneGroups must equal numContexts due to platform constraints"
+  --  severity failure;
+
+  rvsys_gen: for i in 0 to CFG_NRVEX-1 generate
+    constant PIND : integer := CFG_NLEON + i * 2**CFG_RVEX_CFG(i).core.numLaneGroupsLog2;
+    constant PNUM : integer := 2**CFG_RVEX_CFG(i).core.numLaneGroupsLog2;
+  begin
+
+    rvsys_inst: entity rvex.rvsys_grlib
+      generic map (
+        CFG                     => CFG_RVEX_CFG(i),
+        AHB_MASTER_INDEX_START  => PIND,
+        CHECK_MEM               => true,
+        CHECK_MEM_FILE          => "ram.srec"
+      )
+      port map (
+        clki                    => clkm,
+        rstn                    => rstn,
+        ahbmi                   => ahbmi,
+        ahbmo                   => ahbmo(PIND+PNUM-1 downto PIND),
+        ahbsi                   => ahbsi,
+        bus2dgb                 => rvbsi(i),
+        dbg2bus                 => rvbso(i),
+        rctrl2rv                => rctrl2rv((i+1)*2**CFG_RVEX_CFG(i).core.numContextsLog2-1 downto i*2**CFG_RVEX_CFG(i).core.numContextsLog2),
+        rv2rctrl                => rv2rctrl((i+1)*2**CFG_RVEX_CFG(i).core.numContextsLog2-1 downto i*2**CFG_RVEX_CFG(i).core.numContextsLog2)
+      );
+
+    irq_bridge_gen: if CFG_IRQ3_ENABLE /= 0 generate
+      irq_bridge_inst: entity rvex.irq_rctrl_bridge
+        generic map (
+          CFG                     => CFG_RVEX_CFG(i).core
+        )
+        port map (
+          rctrl2rv                => irq_rctrl2rv((i+1)*2**CFG_RVEX_CFG(i).core.numContextsLog2-1 downto i*2**CFG_RVEX_CFG(i).core.numContextsLog2),
+          rv2rctrl                => rv2rctrl((i+1)*2**CFG_RVEX_CFG(i).core.numContextsLog2-1 downto i*2**CFG_RVEX_CFG(i).core.numContextsLog2),
+          irqi                    => irqi(PIND to PIND+PNUM-1),
+          irqo                    => irqo(PIND to PIND+PNUM-1)
+        );
+    end generate;
+    irq_nobridge_gen: if CFG_IRQ3_ENABLE = 0 generate
+      irq_rctrl2rv_gen: for j in i*2**CFG_RVEX_CFG(i).core.numContextsLog2 to (i+1)*2**CFG_RVEX_CFG(i).core.numContextsLog2-1 generate
+        irq_rctrl2rv(j).run       <= '1';
+        irq_rctrl2rv(j).reset     <= '0';
+        irq_rctrl2rv(j).resetVect <= (others => '0');
+        irq_rctrl2rv(j).irq       <= '0';
+        irq_rctrl2rv(j).irqID     <= (others => '0');
+      end generate;
+    end generate;
+
+    rctrl_map_gen: for j in i*2**CFG_RVEX_CFG(i).core.numContextsLog2 to (i+1)*2**CFG_RVEX_CFG(i).core.numContextsLog2-1 generate
+    begin
+      rctrl2rv(j).run       <= irq_rctrl2rv(j).run;--pcie_rctrl2rv(j).run and irq_rctrl2rv(j).run;
+      rctrl2rv(j).reset     <= irq_rctrl2rv(j).reset;--pcie_rctrl2rv(j).reset or irq_rctrl2rv(j).reset;
+      rctrl2rv(j).resetVect <= irq_rctrl2rv(j).resetVect;-- when pcie_rctrl2rv(j).reset = '0' and irq_rctrl2rv(j).reset = '1' else
+                               --pcie_rctrl2rv(j).resetVect;
+
+      rctrl2rv(j).irq       <= irq_rctrl2rv(j).irq;
+      rctrl2rv(j).irqID     <= irq_rctrl2rv(j).irqID;
+    end generate;
+
+  end generate;
+
+----------------------------------------------------------------------
+---  r-VEX bus bridge ------------------------------------------------
+----------------------------------------------------------------------
+
+  rvex_bus_bridge_block: block is
+
+    signal reset        : std_logic;
+    signal clk          : std_logic;
+
+    function addr_map return addrRangeAndMapping_array is
+      variable retval : addrRangeAndMapping_array(0 to N_RVB_SLAVES - 1);
+      variable i : natural;
+    begin
+      i := 0;
+
+      for c in 0 to CFG_NRVEX - 1 loop
+        retval(i) := addrRangeAndMap(
+          match => X"D0" & std_logic_vector(to_unsigned(c, 4)) & "----" & "--------" & "--------"
+        );
+        i := i + 1;
+      end loop;
+
+      if CFG_AHB_UART*CFG_AHB_UART_RVEX = 1 then
+        retval(i) := addrRangeAndMap(
+          match => X"D1" & "--------" & "--------" & "--------"
+        );
+        i := i + 1;
+      end if;
+
+      return retval;
+    end function;
+
+  begin
+
+    reset <= not rstn;
+    clk <= clkm;
+
+    -- Instantiate the bus bridge.
+    rvex_bus_bridge_inst: entity rvex.ahb2bus
+      generic map (
+        AHB_INDEX       => 9,
+        AHB_ADDR        => 16#D00#,
+        AHB_MASK        => 16#F00#,
+        AHB_VENDOR_ID   => VENDOR_TUDELFT,
+        AHB_DEVICE_ID   => TUDELFT_BRIDGE
+      )
+      port map (
+        reset           => reset,
+        clk             => clk,
+        ahb2bridge      => ahbsi,
+        bridge2ahb      => ahbso(9),
+        bridge2bus      => rvbmo,
+        bus2bridge      => rvbmi
+      );
+
+    -- Instantiate the demuxer.
+    rvex_bus_bridge_demux: entity rvex.bus_demux
+      generic map (
+        ADDRESS_MAP     => addr_map
+      )
+      port map (
+        reset           => reset,
+        clk             => clk,
+        clkEn           => '1',
+        mst2demux       => rvbmo,
+        demux2mst       => rvbmi,
+        demux2slv       => rvbsi,
+        slv2demux       => rvbso
+      );
+
+  end block;
+
+----------------------------------------------------------------------
+---  r-VEX PCIe interface --------------------------------------------
+----------------------------------------------------------------------
+
+  pcie_dma_block: block is
+
+    signal reset        : std_logic;
+    signal clk          : std_logic;
+    signal dma2bus      : bus_mst2slv_array(1 downto 0);
+    signal bus2dma      : bus_slv2mst_array(1 downto 0);
+
+      -- temp signals
+    signal user_lnk_up    : std_logic;
+    signal user_reset     : std_logic;
+    signal buf : std_logic;
+
+  begin
+
+    reset <= not rstn;
+    clk <= clkm;
+
+    -- Instantiate the bus bridge for c2s.
+    ahb_bus_bridges: for i in 0 to 1 generate
+      ahb_bus_bridge_insts: entity rvex.bus2ahb
+        generic map (
+
+          -- Generic information as passed to grlib.dma2ahb.
+          AHB_MASTER_INDEX        => CFG_NCPU+CFG_AHB_UART+CFG_AHB_JTAG+CFG_GRETH+CFG_SVGA_ENABLE+CFG_PCIEXP+i,
+          AHB_VENDOR_ID           => VENDOR_TUDELFT,
+          AHB_DEVICE_ID           => TUDELFT_RVEX,
+          AHB_VERSION             => 0,
+
+          -- rvex bus fault code used to indicate that an AHB bus error occured.
+          BUS_ERROR_CODE          => X"00000000",
+
+          -- rvex bus fault code used to indicate that an invalid rvex bus
+          -- request was issued.
+          REQ_ERROR_CODE          => X"00000001"
+
+        )
+        port map (
+
+          reset                   => reset,
+          clk                     => clk,
+          bus2bridge              => dma2bus(i),
+          bridge2bus              => bus2dma(i),
+          bridge2ahb              => ahbmo(CFG_NCPU+CFG_AHB_UART+CFG_AHB_JTAG+CFG_GRETH+CFG_SVGA_ENABLE+CFG_PCIEXP+i),
+          ahb2bridge              => ahbmi
+
+        );
+    end generate;
+
+
+    pcie_dma: entity work.dma
+    generic map (
+      NO_OF_LANES             => CFG_NO_OF_LANES,
+      --NO_CONTEXTS             => 2**CFG_RVEX_CFG.core.numContextsLog2,
+      NO_CONTEXTS             => 1,
+      NO_RVEX                 => CFG_NRVEX
+    )
+    port map (
+      reset                   => reset,
+
+      pcie_txp                => pci_exp_txp,
+      pcie_txn                => pci_exp_txn,
+      pcie_rxp                => pci_exp_rxp,
+      pcie_rxn                => pci_exp_rxn,
+
+      pcie_clk_p              => sys_clk_p,
+      pcie_clk_n              => sys_clk_n,
+
+      -- PCI Express slot PERST# reset signal
+      perst_n                 => sys_reset_n_c,
+
+      bus_clk                 => clkm,
+      bus2dma_c2s             => bus2dma(0),
+      dma2bus_c2s             => dma2bus(0),
+      bus2dma_s2c             => bus2dma(1),
+      dma2bus_s2c             => dma2bus(1),
+
+      rctrl_clk               => clkm,
+      rctrl2rv                => pcie_rctrl2rv,
+      rv2rctrl                => rv2rctrl,
+
+
+      user_lnk_up_out    => user_lnk_up,
+      user_reset_out     => user_reset
+    );
+
+    led(6) <= user_lnk_up;
+    led(7) <= user_reset;
+  end block;
+
+----------------------------------------------------------------------
 ---  Memory controllers ----------------------------------------------
 ----------------------------------------------------------------------
 
@@ -429,7 +838,7 @@ begin
 --  mig_gen : if (CFG_MIG_DDR2 = 1) generate
 
     ahb2mig0 : ahb2mig_ml605
-      generic map ( hindex => 0, haddr => 16#400#, hmask => 16#E00#,
+      generic map ( hindex => 0, haddr => 16#000#, hmask => 16#E00#,
     MHz => 400, Mbyte => 512, nosync => boolean'pos(CFG_MIG_CLK4=12)) --CFG_CLKDIV/12)
       port map (
     rst => rstn, clk_ahb => clkm, clk_ddr => clk_ddr,
@@ -478,12 +887,11 @@ begin
     led(3)  <= phy_init_done;
     led(4)  <= rstn;
     led(5)  <= reset;
-    led(6)  <= '0';
     lock    <= phy_init_done; -- and cgo.clklock;
 
 --    end generate;
 --    noddr : if (CFG_DDR2SP+CFG_MIG_DDR2) = 0 generate lock <= cgo.clklock; end generate;
- 
+
 ----------------------------------------------------------------------
 ---  System ACE I/F Controller ---------------------------------------
 ----------------------------------------------------------------------
@@ -525,15 +933,15 @@ EP: pcie_master_target_virtex
     vendor_id        => CFG_PCIEXPVID,	 -- PCIE vendor ID
     pcie_bar_mask    => 16#FFE#,
     nsync            => 2,   -- 1 or 2 sync regs between clocks
-    haddr            => 16#a00#,    
-    hmask            => 16#fff#,   
-    pindex           => 5,   
-    paddr            => 5,   
+    haddr            => 16#a00#,
+    hmask            => 16#fff#,
+    pindex           => 5,
+    paddr            => 5,
     pmask            => 16#fff#,
-    Master           => CFG_PCIE_SIM_MAS,  
-    lane_width       => CFG_NO_OF_LANES  
+    Master           => CFG_PCIE_SIM_MAS,
+    lane_width       => CFG_NO_OF_LANES
           )
-  port map( 
+  port map(
     rst              => rstn,
     clk              => clkm,
     -- System Interface
@@ -545,25 +953,25 @@ EP: pcie_master_target_virtex
     pci_exp_txn      => pci_exp_txn,
     pci_exp_rxp      => pci_exp_rxp,
     pci_exp_rxn      => pci_exp_rxn,
-    
-    ahbso            => ahbso(8),        
-    ahbsi            => ahbsi,         
-    apbi             => apbi,	      
-    apbo             => apbo(5),	      
+
+    ahbso            => ahbso(8),
+    ahbsi            => ahbsi,
+    apbi             => apbi,
+    apbo             => apbo(5),
     ahbmi            => ahbmi,
-    ahbmo            => ahbmo(CFG_NCPU+CFG_AHB_UART+CFG_AHB_JTAG+CFG_GRETH+CFG_SVGA_ENABLE)    
+    ahbmo            => ahbmo(CFG_NCPU+CFG_AHB_UART+CFG_AHB_JTAG+CFG_GRETH+CFG_SVGA_ENABLE)
   );
     end generate;
 ------------------PCI-EXPRESS-Master-FIFO------------------------------------------
 pcie_mf : if CFG_PCIE_TYPE = 3 generate	-- master with fifo and DMA
 dma:pciedma
-      generic map (fabtech => fabtech, memtech => memtech, dmstndx =>(CFG_NCPU+CFG_AHB_UART+CFG_AHB_JTAG+CFG_GRETH+CFG_SVGA_ENABLE), 
+      generic map (fabtech => fabtech, memtech => memtech, dmstndx =>(CFG_NCPU+CFG_AHB_UART+CFG_AHB_JTAG+CFG_GRETH+CFG_SVGA_ENABLE),
 	  dapbndx => 8, dapbaddr => 8,dapbirq => 8, blength => 12, abits => 21,
 	  device_id => CFG_PCIEXPDID, vendor_id => CFG_PCIEXPVID, pcie_bar_mask => 16#FFE#,
 	  slvndx => 8, apbndx => 5, apbaddr => 5, haddr => 16#A00#,hmask=> 16#FFF#,
 	  nsync => 2,lane_width => CFG_NO_OF_LANES)
 
-port map( 
+port map(
     rst          => rstn,
     clk          => clkm,
     -- System Interface
@@ -575,7 +983,7 @@ port map(
     pci_exp_txn  => pci_exp_txn,
     pci_exp_rxp  => pci_exp_rxp,
     pci_exp_rxn  => pci_exp_rxn,
-    
+
     dapbo        => apbo(8),
     dahbmo       => ahbmo((CFG_NCPU+CFG_AHB_UART+CFG_AHB_JTAG+CFG_GRETH+CFG_SVGA_ENABLE)),
     apbi         => apbi,
@@ -583,17 +991,17 @@ port map(
     ahbmi        => ahbmi,
     ahbsi        => ahbsi,
     ahbso        => ahbso(8)
-  
+
   );
     end generate;
 ----------------------------------------------------------------------
-pcie_mf_no_dma: if CFG_PCIE_TYPE = 2 generate	-- master with fifo 
+pcie_mf_no_dma: if CFG_PCIE_TYPE = 2 generate	-- master with fifo
 EP:pcie_master_fifo_virtex
-generic map (fabtech => fabtech, memtech => memtech, 
+generic map (fabtech => fabtech, memtech => memtech,
    hslvndx => 8, abits => 21, device_id => CFG_PCIEXPDID, vendor_id => CFG_PCIEXPVID,
    pcie_bar_mask => 16#FFE#, pindex => 5, paddr => 5,
   haddr => 16#A00#, hmask => 16#FFF#, nsync => 2, lane_width => CFG_NO_OF_LANES)
-port map( 
+port map(
     rst          => rstn,
     clk          => clkm,
     -- System Interface
@@ -605,11 +1013,11 @@ port map(
     pci_exp_txn  => pci_exp_txn,
     pci_exp_rxp  => pci_exp_rxp,
     pci_exp_rxn  => pci_exp_rxn,
-    
-    ahbso        => ahbso(8),        
-    ahbsi        => ahbsi,         
-    apbi         => apbi,        
-    apbo         => apbo(5)        
+
+    ahbso        => ahbso(8),
+    ahbsi        => ahbsi,
+    apbi         => apbi,
+    apbo         => apbo(5)
   );
 end generate;
 ----------------------------------------------------------------------
@@ -792,6 +1200,13 @@ end generate;
       port map (emdc, etho.mdc);
   end generate;
 
+  eth_out : if (CFG_GRETH /= 1) generate
+      emdc <= '0';
+      etx_en <= '0';
+      etx_er <= '0';
+      etxd <= (others => '0');
+  end generate;
+
 -----------------------------------------------------------------------
 ---  AHB ROM ----------------------------------------------------------
 -----------------------------------------------------------------------
@@ -832,7 +1247,7 @@ end generate;
 ---  Drive unused bus elements  ---------------------------------------
 -----------------------------------------------------------------------
 
-  nam1 : for i in (CFG_NCPU+CFG_AHB_UART+CFG_AHB_JTAG+CFG_GRETH+1+CFG_PCIEXP) to NAHBMST-1 generate
+  nam1 : for i in (CFG_NCPU+CFG_AHB_UART+CFG_AHB_JTAG+CFG_GRETH+CFG_SVGA_ENABLE+CFG_PCIEXP+2*CFG_AHB_PCIE) to NAHBMST-1 generate
     ahbmo(i) <= ahbm_none;
   end generate;
 
diff -rupN '--exclude=ram.srec' ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/Makefile work/Makefile
--- ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/Makefile	2014-04-16 16:50:08.000000000 +0200
+++ work/Makefile	2015-11-05 12:40:53.176538481 +0100
@@ -1,5 +1,5 @@
 include .config
-GRLIB=../..
+GRLIB=../../../grlib/grlib-gpl-1.3.7-b4144
 TOP=leon3mp
 DESIGN=leon3-xilinx-ml605
 BOARD=xilinx-ml605-xc6vlx240t
@@ -14,6 +14,7 @@ EFFORT=high
 XSTOPT=-uc leon3mp.xcf
 SYNPOPT="set_option -pipe 1; set_option -retiming 0; set_option -enable_prepacking 1;\
 set_option -write_apr_constraint 0;set_option -resource_sharing 1; set_option -symbolic_fsm_compiler 1"
+
 VHDLOPTSYNFILES= \
 	mig_37/user_design/rtl/controller/arb_mux.vhd \
 	mig_37/user_design/rtl/controller/arb_row_col.vhd \
@@ -66,99 +67,61 @@ VHDLOPTSYNFILES= \
 	mig_37/user_design/rtl/ui/ui_rd_data.vhd \
 	mig_37/user_design/rtl/ui/ui_top.vhd \
 	mig_37/user_design/rtl/ui/ui_wr_data.vhd \
-	pcie/v6_pcie_v1_7/source/*.vhd \
 	$(GRLIB)/lib/gaisler/pcie/pcie.vhd
 
-ifeq ("$(CONFIG_PCIEXP_MASTER_TARGET)","y")
-  ifeq ("$(CONFIG_LANE_WIDTH1)","y")
-  UCF+=pcie_ucf/pcie_master_target_lane1.ucf
-  UCF_PLANAHEAD+=pcie_ucf/pcie_master_target_lane1.ucf
-  endif
-  ifeq ("$(CONFIG_LANE_WIDTH2)","y")
-  UCF+=pcie_ucf/pcie_master_target_lane2.ucf
-  UCF_PLANAHEAD+=pcie_ucf/pcie_master_target_lane2.ucf
-  endif
-  ifeq ("$(CONFIG_LANE_WIDTH4)","y")
-  UCF+=pcie_ucf/pcie_master_target_lane4.ucf
-  UCF_PLANAHEAD+=pcie_ucf/pcie_master_target_lane4.ucf
-  endif
-  ifeq ("$(CONFIG_LANE_WIDTH8)","y")
-  UCF+=pcie_ucf/pcie_master_target_lane8.ucf
-  UCF_PLANAHEAD+=pcie_ucf/pcie_master_target_lane8.ucf
-  endif
-VHDLOPTSYNFILES+=$(GRLIB)/lib/gaisler/pcie/pcie_master_target_virtex.vhd
-endif
-ifeq ("$(CONFIG_PCIEXP_MASTER_FIFO)","y")
-  ifeq ("$(CONFIG_PCIEXP_MASTER_FIFO_DMA)","y")
-    ifeq ("$(CONFIG_LANE_WIDTH1)","y")
-    UCF+=pcie_ucf/pcie_master_fifo_dma_lane1.ucf
-    UCF_PLANAHEAD+=pcie_ucf/pcie_master_fifo_dma_lane1.ucf
-    endif
-    ifeq ("$(CONFIG_LANE_WIDTH2)","y")
-    UCF+=pcie_ucf/pcie_master_fifo_dma_lane2.ucf
-    UCF_PLANAHEAD+=pcie_ucf/pcie_master_fifo_dma_lane2.ucf
-    endif
-    ifeq ("$(CONFIG_LANE_WIDTH4)","y")
-    UCF+=pcie_ucf/pcie_master_fifo_dma_lane4.ucf
-    UCF_PLANAHEAD+=pcie_ucf/pcie_master_fifo_dma_lane4.ucf
-    endif
-VHDLOPTSYNFILES+=$(GRLIB)/lib/gaisler/pcie/pcie_master_fifo_virtex.vhd
-VHDLOPTSYNFILES+=$(GRLIB)/lib/gaisler/pcie/pciedma.vhd
-  endif
-  ifneq ("$(CONFIG_PCIEXP_MASTER_FIFO_DMA)","y")
-    ifeq ("$(CONFIG_LANE_WIDTH1)","y")
-    UCF+=pcie_ucf/pcie_master_fifo_lane1.ucf
-    UCF_PLANAHEAD+=pcie_ucf/pcie_master_fifo_lane1.ucf
-    endif
-    ifeq ("$(CONFIG_LANE_WIDTH2)","y")
-    UCF+=pcie_ucf/pcie_master_fifo_lane2.ucf
-    UCF_PLANAHEAD+=pcie_ucf/pcie_master_fifo_lane2.ucf
-    endif
-    ifeq ("$(CONFIG_LANE_WIDTH4)","y")
-    UCF+=pcie_ucf/pcie_master_fifo_lane4.ucf
-    UCF_PLANAHEAD+=pcie_ucf/pcie_master_fifo_lane4.ucf
-    endif
-VHDLOPTSYNFILES+=$(GRLIB)/lib/gaisler/pcie/pcie_master_fifo_virtex.vhd
-  endif
-endif
 
 VERILOGOPTSYNFILES= \
 	mig/user_design/rtl/controller/*.v \
 	mig/user_design/rtl/ecc/*.v \
 	mig/user_design/rtl/ip_top/*.v \
 	mig/user_design/rtl/phy/*.v \
-	mig/user_design/rtl/phy/*.v \
 	mig/user_design/rtl/ui/*.v \
-	$$XILINX/verilog/src/glbl.v
+	$$XILINX/verilog/src/glbl.v \
+	pcie/pcie_v2_5/source/*.v \
+	../design/nw_dma/c2s_pkt_streaming_fifo.v \
+	../design/nw_dma/ref_inferred_shallow_ram.v \
+	../design/nw_dma/ref_tiny_fifo.v \
+	../design/nw_dma/ref_inferred_block_ram.v \
+	../design/nw_dma/ref_sc_fifo_shallow_ram.v  \
+	../design/nw_dma/s2c_pkt_streaming_fifo.v \
+	../design/nw_dma/s2c_pkt_streaming_fifo.v \
+	../design/nw_dma/model/dma_back_end_pkt_model.v \
+	../design/dma/packet_dma.v
 VHDLSYNFILES= \
+	../design/pcie/pcie_v2_5.vhd \
+	../design/dma/constants_pkg.vhd \
+	../design/dma/packet_dma.vhd \
+	../design/dma/c2s_bus_bridge.vhd \
+	../design/dma/s2c_bus_bridge.vhd \
+	../design/dma/registers.vhd \
+	../design/dma/dma.vhd \
 	ahb2mig_ml605.vhd config.vhd ahbrom.vhd \
 	svga2ch7301c.vhd gtxclk.vhd leon3mp.vhd
 
-VHDLSIMFILES=testbench.vhd
-
-ifeq ("$(CONFIG_PCIEXP_MASTER_TARGET)","y")
-VHDLSIMFILES+=$(GRLIB)/lib/tech/unisim/ise/GTPA1_DUAL.vhd $(GRLIB)/lib/tech/unisim/ise/GTP_DUAL.vhd \
-$(GRLIB)/lib/tech/unisim/ise/GTXE1.vhd $(GRLIB)/lib/tech/unisim/ise/GTX_DUAL.vhd \
-$(GRLIB)/lib/tech/unisim/ise/PCIE_2_0.vhd $(GRLIB)/lib/tech/unisim/ise/PCIE_A1.vhd
-else 
-ifeq ("$(CONFIG_PCIEXP_MASTER_FIFO)","y")
-VHDLSIMFILES+=$(GRLIB)/lib/tech/unisim/ise/GTPA1_DUAL.vhd $(GRLIB)/lib/tech/unisim/ise/GTP_DUAL.vhd \
-$(GRLIB)/lib/tech/unisim/ise/GTXE1.vhd $(GRLIB)/lib/tech/unisim/ise/GTX_DUAL.vhd \
-$(GRLIB)/lib/tech/unisim/ise/PCIE_2_0.vhd $(GRLIB)/lib/tech/unisim/ise/PCIE_A1.vhd
-endif
-endif
+VERILOGSIMFILES = \
+	../design/tb/dsport/pcie_2_0_rport_v6.v \
+	../design/tb/dsport/pci_exp_usrapp_cfg.v \
+	../design/tb/dsport/pci_exp_usrapp_pl.v \
+	../design/tb/dsport/pci_exp_usrapp_tx.v \
+	../design/tb/dsport/pci_exp_usrapp_com.v \
+	../design/tb/dsport/pci_exp_usrapp_rx.v \
+	../design/tb/dsport/xilinx_pcie_2_0_rport_v6.v
+VHDLSIMFILES= \
+	../design/tb/pcie_tb.vhd \
+	testbench.vhd
 
 SIMTOP=testbench
 SDCFILE=default.sdc
 BITGEN=$(GRLIB)/boards/$(BOARD)/default.ut
 CLEAN=soft-clean migclean pcieclean
 TECHLIBS = secureip unisim
-VLOGOPT= -O0
-VCOMOPT= -explicit -O0 
+EXTRALIBS=../../../lib
+VLOGOPT= -O0 +incdir+../design/tb/include
+VCOMOPT= -explicit -O0
 ifeq ("$(GRLIB_SIMULATOR)","ALDEC")
 VSIMOPT= +access +w -t ps -novopt +notimingchecks -L secureip_ver -L xilinxcorelib_ver -L unisims_ver glbl $(SIMTOP)
 else
-VSIMOPT= -t ps -novopt +notimingchecks -L secureip_ver -L xilinxcorelib_ver -L unisims_ver glbl $(SIMTOP)
+VSIMOPT= -t ps -do ../phy.do -novopt +notimingchecks -L secureip_ver -L xilinxcorelib_ver -L unisims_ver glbl $(SIMTOP)
 endif
 
 LIBSKIP = core1553bbc core1553brm core1553brt gr1553 corePCIF \
@@ -175,6 +138,9 @@ include $(GRLIB)/software/leon3/Makefile
 
 ##################  project specific targets ##########################
 
+# Stop deleting logs!
+.SECONDARY:
+
 mig_37 mig:
 	cp grlib_mig/mig.* .
 	coregen -b mig.xco -p mig.cgp
@@ -193,10 +159,11 @@ migclean:
 	-rm -rf tmp coregen* mig*
 
 pcie:
-	coregen -b pcie/pcie.xco -p pcie
-	patch -p0 < pcie.diff
+	mkdir -p pcie
+	cp ../design/pcie/coregen.cgp pcie
+	coregen -b ../design/pcie/pcie.xco -p pcie
 
 pcieclean:
-	-rm -rf pcie/v6_pcie_v1_7* pcie/tmp pcie/coregen.cgc tx.dat rx.dat
+	-rm -rf pcie tx.dat rx.dat
 
 .PHONY : pcie pcieclean
diff -rupN '--exclude=ram.srec' ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/pcie/coregen.cgp work/pcie/coregen.cgp
--- ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/pcie/coregen.cgp	2014-04-16 16:50:08.000000000 +0200
+++ work/pcie/coregen.cgp	1970-01-01 01:00:00.000000000 +0100
@@ -1,22 +0,0 @@
-# Date: Wed Aug  8 14:52:14 2012
-
-SET addpads = false
-SET asysymbol = true
-SET busformat = BusFormatAngleBracketNotRipped
-SET createndf = false
-SET designentry = VHDL
-SET device = xc6vlx240t
-SET devicefamily = virtex6
-SET flowvendor = Other
-SET formalverification = false
-SET foundationsym = false
-SET implementationfiletype = Ngc
-SET package = ff1156
-SET removerpms = false
-SET simulationfiles = Behavioral
-SET speedgrade = -1
-SET verilogsim = false
-SET vhdlsim = true
-SET workingdirectory = ./tmp/
-
-# CRC: efb42278
diff -rupN '--exclude=ram.srec' ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/pcie/pcie.xco work/pcie/pcie.xco
--- ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/pcie/pcie.xco	2014-04-16 16:50:08.000000000 +0200
+++ work/pcie/pcie.xco	1970-01-01 01:00:00.000000000 +0100
@@ -1,205 +0,0 @@
-##############################################################
-#
-# Xilinx Core Generator version 13.2
-# Date: Wed Aug  8 14:55:22 2012
-#
-##############################################################
-#
-#  This file contains the customisation parameters for a
-#  Xilinx CORE Generator IP GUI. It is strongly recommended
-#  that you do not manually alter this file as it may cause
-#  unexpected and unsupported behavior.
-#
-##############################################################
-#
-#  Generated from component: xilinx.com:ip:v6_pcie:1.7
-#
-##############################################################
-#
-# BEGIN Project Options
-SET addpads = false
-SET asysymbol = true
-SET busformat = BusFormatAngleBracketNotRipped
-SET createndf = false
-SET designentry = VHDL
-SET device = xc6vlx240t
-SET devicefamily = virtex6
-SET flowvendor = Other
-SET formalverification = false
-SET foundationsym = false
-SET implementationfiletype = Ngc
-SET package = ff1156
-SET removerpms = false
-SET simulationfiles = Behavioral
-SET speedgrade = -1
-SET verilogsim = false
-SET vhdlsim = true
-# END Project Options
-# BEGIN Select
-SELECT Virtex-6_Integrated_Block_for_PCI_Express family Xilinx,_Inc. 1.7
-# END Select
-# BEGIN Parameters
-CSET acceptable_l0s_latency=Maximum_of_64_ns
-CSET acceptable_l1_latency=No_limit
-CSET ack_nak_timeout_func=Absolute
-CSET ack_nak_timeout_value=0000
-CSET bar0_64bit=false
-CSET bar0_enabled=true
-CSET bar0_prefetchable=false
-CSET bar0_scale=Megabytes
-CSET bar0_size=2
-CSET bar0_type=Memory
-CSET bar1_64bit=false
-CSET bar1_enabled=false
-CSET bar1_prefetchable=false
-CSET bar1_scale=Kilobytes
-CSET bar1_size=2
-CSET bar1_type=N/A
-CSET bar2_64bit=false
-CSET bar2_enabled=false
-CSET bar2_prefetchable=false
-CSET bar2_scale=Bytes
-CSET bar2_size=128
-CSET bar2_type=N/A
-CSET bar3_64bit=false
-CSET bar3_enabled=false
-CSET bar3_prefetchable=false
-CSET bar3_scale=Kilobytes
-CSET bar3_size=2
-CSET bar3_type=N/A
-CSET bar4_64bit=false
-CSET bar4_enabled=false
-CSET bar4_prefetchable=false
-CSET bar4_scale=Kilobytes
-CSET bar4_size=2
-CSET bar4_type=N/A
-CSET bar5_enabled=false
-CSET bar5_prefetchable=false
-CSET bar5_scale=Kilobytes
-CSET bar5_size=2
-CSET bar5_type=N/A
-CSET base_class_menu=Simple_communication_controllers
-CSET buf_opt_bma=false
-CSET cardbus_cis_pointer=00000000
-CSET class_code_base=05
-CSET class_code_interface=00
-CSET class_code_sub=00
-CSET component_name=v6_pcie_v1_7
-CSET cost_table=1
-CSET cpl_finite=false
-CSET cpl_timeout_disable_sup=false
-CSET cpl_timeout_range=Range_B
-CSET d0_pme_support=true
-CSET d0_power_consumed=0
-CSET d0_power_consumed_factor=0
-CSET d0_power_dissipated=0
-CSET d0_power_dissipated_factor=0
-CSET d1_pme_support=true
-CSET d1_power_consumed=0
-CSET d1_power_consumed_factor=0
-CSET d1_power_dissipated=0
-CSET d1_power_dissipated_factor=0
-CSET d1_support=false
-CSET d2_pme_support=true
-CSET d2_power_consumed=0
-CSET d2_power_consumed_factor=0
-CSET d2_power_dissipated=0
-CSET d2_power_dissipated_factor=0
-CSET d2_support=false
-CSET d3_power_consumed=0
-CSET d3_power_consumed_factor=0
-CSET d3_power_dissipated=0
-CSET d3_power_dissipated_factor=0
-CSET d3cold_pme_support=false
-CSET d3hot_pme_support=true
-CSET de_emph=0
-CSET device_id=0007
-CSET device_port_type=PCI_Express_Endpoint_device
-CSET device_specific_initialization=false
-CSET disable_tx_aspm_l0s=false
-CSET dll_link_active_cap=false
-CSET downstream_link_num=00
-CSET dsn_enabled=true
-CSET en_route_err_cor=false
-CSET en_route_err_ftl=false
-CSET en_route_err_nfl=false
-CSET en_route_inta=false
-CSET en_route_intb=false
-CSET en_route_intc=false
-CSET en_route_intd=false
-CSET en_route_pm_pme=false
-CSET en_route_pme_to=false
-CSET en_route_pme_to_ack=false
-CSET en_route_unlock=false
-CSET enable_ack_nak_timer=false
-CSET enable_lane_reversal=false
-CSET enable_replay_timer=true
-CSET enable_slot_clock_cfg=true
-CSET expansion_rom_enabled=false
-CSET expansion_rom_scale=Kilobytes
-CSET expansion_rom_size=2
-CSET ext_pci_cfg_space=false
-CSET ext_pci_cfg_space_addr=3FF
-CSET extended_tag_field=false
-CSET force_no_scrambling=false
-CSET hw_auton_spd_disable=false
-CSET intx_generation=true
-CSET io_base_limit_registers=Disabled
-CSET legacy_interrupt=INTA
-CSET link_speed=2.5_GT/s
-CSET max_payload_size=128_bytes
-CSET maximum_link_width=X8
-CSET msi_64b=true
-CSET msi_enabled=true
-CSET msi_vec_mask=false
-CSET msix_enabled=false
-CSET msix_pba_bir=BAR_0
-CSET msix_pba_offset=0
-CSET msix_table_bir=BAR_0
-CSET msix_table_offset=0
-CSET msix_table_size=1
-CSET multiple_message_capable=1_vector
-CSET no_soft_reset=true
-CSET pci_cfg_space=false
-CSET pci_cfg_space_addr=3F
-CSET pcie_blk_locn=X0Y0
-CSET pcie_cap_slot_implemented=false
-CSET pcie_debug_ports=false
-CSET perf_level=Good
-CSET phantom_functions=No_function_number_bits_used
-CSET pipe_pipeline=None
-CSET prefetchable_memory_base_limit_registers=Disabled
-CSET rcb=64_byte
-CSET ref_clk_freq=100_MHz
-CSET replay_timeout_func=Add
-CSET replay_timeout_value=0026
-CSET revision_id=00
-CSET root_cap_crs=false
-CSET slot_cap_attn_butn=false
-CSET slot_cap_attn_ind=false
-CSET slot_cap_elec_interlock=false
-CSET slot_cap_hotplug_cap=false
-CSET slot_cap_hotplug_surprise=false
-CSET slot_cap_mrl=false
-CSET slot_cap_no_cmd_comp_sup=false
-CSET slot_cap_physical_slot_num=0
-CSET slot_cap_pwr_ctrl=false
-CSET slot_cap_pwr_ind=false
-CSET slot_cap_pwr_limit_scale=0
-CSET slot_cap_pwr_limit_value=0
-CSET sub_class_interface_menu=Generic_XT_compatible_serial_controller
-CSET subsystem_id=0007
-CSET subsystem_vendor_id=10EE
-CSET trans_buf_pipeline=None
-CSET trgt_link_speed=4'h1
-CSET trim_tlp_digest=false
-CSET upconfigure_capable=true
-CSET user_clk_freq=250_default
-CSET vc_cap_enabled=false
-CSET vc_cap_reject_snoop=false
-CSET vendor_id=10EE
-CSET vsec_enabled=false
-CSET xlnx_ref_board=ML_605
-# END Parameters
-GENERATE
-# CRC: 1ab9c854
diff -rupN '--exclude=ram.srec' ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/testbench.vhd work/testbench.vhd
--- ../../grlib/grlib-gpl-1.3.7-b4144/designs/leon3-xilinx-ml605/testbench.vhd	2014-04-16 16:51:31.000000000 +0200
+++ work/testbench.vhd	2015-11-05 12:40:53.176538481 +0100
@@ -18,7 +18,7 @@
 --
 --  You should have received a copy of the GNU General Public License
 --  along with this program; if not, write to the Free Software
---  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA 
+--  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 ------------------------------------------------------------------------------
 
 library ieee;
@@ -97,7 +97,7 @@ constant SIM_BYPASS_INIT_CAL : string :=
   signal ddr3_ck_p     : std_logic_vector(CK_WIDTH-1 downto 0);
   signal ddr3_ck_n     : std_logic_vector(CK_WIDTH-1 downto 0);
 
-  
+
   -- Debug support unit
   signal dsubre     : std_ulogic;
 
@@ -128,7 +128,7 @@ constant SIM_BYPASS_INIT_CAL : string :=
   signal gmiiclk_n  : std_logic := '0';
 
   -- Output signals for LEDs
-  signal led       : std_logic_vector(6 downto 0);
+  signal led       : std_logic_vector(7 downto 0);
 
 signal iic_scl_main, iic_sda_main : std_logic;
 signal iic_scl_dvi, iic_sda_dvi : std_logic;
@@ -151,9 +151,8 @@ signal clk_33          : std_ulogic := '
 
 ---------------------pcie----------------------------------------------
 signal cor_sys_reset_n : std_logic := '1';
-signal ep_sys_clk_p    : std_logic;
-signal ep_sys_clk_n    : std_logic;
-signal rp_sys_clk      : std_logic;
+signal ep_sys_clk_p    : std_logic := '1';
+signal ep_sys_clk_n    : std_logic := '0';
 
 signal cor_pci_exp_txn : std_logic_vector(CFG_NO_OF_LANES-1 downto 0);
 signal cor_pci_exp_txp : std_logic_vector(CFG_NO_OF_LANES-1 downto 0);
@@ -171,11 +170,14 @@ begin
   gmiiclk_p    <= not gmiiclk_p after 4 ns;
   gmiiclk_n    <= not gmiiclk_n after 4 ns;
   clk_33       <= not clk_33 after 15 ns;
-  rst        <= '1', '0' after 200 us;
+  ep_sys_clk_p <= not ep_sys_clk_p after 2 ns; -- 2 ns half cycle -> 250 MHz
+  ep_sys_clk_n <= not ep_sys_clk_n after 2 ns; -- 2 ns half cycle -> 250 MHz
+  rst        <= '1', '0' after 20 us;
   rstn1      <= not rst;
+  cor_sys_reset_n <= not rst;
   dsubre     <= '0';
   urxd       <= 'H';
-  
+
   d3 : entity work.leon3mp
     generic map (fabtech, memtech, padtech, disas, dbguart, pclow,
                  SIM_BYPASS_INIT_CAL)
@@ -208,9 +210,9 @@ begin
       ddr3_dqs_n    => ddr3_dqs_n,
       ddr3_ck_p     => ddr3_ck_p,
       ddr3_ck_n     => ddr3_ck_n,
-      
+
       -- Debug Unit
-      dsubre    => dsubre,
+      --dsubre    => dsubre,
 
       -- AHB Uart
       dsutx     => dsutx,
@@ -235,34 +237,60 @@ begin
       emdio     => emdio,
 
       -- Output signals for LEDs
-        iic_scl_main => iic_scl_main, 
+        iic_scl_main => iic_scl_main,
 	iic_sda_main => iic_sda_main,
-        dvi_iic_scl => iic_scl_dvi, 
+        dvi_iic_scl => iic_scl_dvi,
 	dvi_iic_sda => iic_sda_dvi,
-        tft_lcd_data => tft_lcd_data, 
-	tft_lcd_clk_p => tft_lcd_clk_p, 
-	tft_lcd_clk_n => tft_lcd_clk_n, 
+        tft_lcd_data => tft_lcd_data,
+	tft_lcd_clk_p => tft_lcd_clk_p,
+	tft_lcd_clk_n => tft_lcd_clk_n,
 	tft_lcd_hsync => tft_lcd_hsync,
-        tft_lcd_vsync => tft_lcd_vsync, 
-	tft_lcd_de => tft_lcd_de, 
+        tft_lcd_vsync => tft_lcd_vsync,
+	tft_lcd_de => tft_lcd_de,
 	tft_lcd_reset_b => tft_lcd_reset_b,
-        clk_33 => clk_33, 
-        sysace_mpa => sysace_mpa, 
-	sysace_mpce => sysace_mpce, 
-	sysace_mpirq => sysace_mpirq, 
+        clk_33 => clk_33,
+        sysace_mpa => sysace_mpa,
+	sysace_mpce => sysace_mpce,
+	sysace_mpirq => sysace_mpirq,
 	sysace_mpoe => sysace_mpoe,
-        sysace_mpwe => sysace_mpwe, 
+        sysace_mpwe => sysace_mpwe,
 	sysace_d => sysace_d,
         pci_exp_txp=> cor_pci_exp_txp,
         pci_exp_txn=> cor_pci_exp_txn,
         pci_exp_rxp=> cor_pci_exp_rxp,
         pci_exp_rxn=> cor_pci_exp_rxn,
-        sys_clk_p=> ep_sys_clk_p,   
+        sys_clk_p=> ep_sys_clk_p,
         sys_clk_n=> ep_sys_clk_n,
         sys_reset_n=> cor_sys_reset_n,
         led => led
       );
 
+  pcie: entity work.xilinx_pcie_tb
+    generic map (
+      REF_CLK_FREQ                            => 2, -- 0 - 100 MHz, 1 - 125 MHz,  2 - 250 MHz
+      PL_FAST_TRAIN                           => "TRUE",
+      LINK_CAP_MAX_LINK_WIDTH                 => 4, -- 1 - x1, 2 - x2, 4 - x4, 8 - x8
+      DEVICE_ID                               => 16#0007#,
+      LINK_CAP_MAX_LINK_SPEED                 => 1,
+      LINK_CTRL2_TARGET_LINK_SPEED            => 0,
+      DEV_CAP_MAX_PAYLOAD_SUPPORTED           => 0, -- 0 - 128B, 1 - 256B, 3 - 512B, 4 - 1024B
+      VC0_TX_LASTPACKET                       => 31,
+      VC0_RX_RAM_LIMIT                        => 16#7FF#,
+      VC0_CPL_INFINITE                        => "FALSE",
+      VC0_TOTAL_CREDITS_PD                    => 154,
+      VC0_TOTAL_CREDITS_CD                    => 154,
+      UPCONFIG_CAPABLE                        => "FALSE",
+      LINK_CAP_DLL_LINK_ACTIVE_REPORTING_CAP  => "TRUE"
+    )
+    port map (
+      sys_clk         => ep_sys_clk_p,
+      sys_reset_n     => cor_sys_reset_n,
+
+      pci_exp_rxp     => cor_pci_exp_txp,
+      pci_exp_txp     => cor_pci_exp_rxp,
+      pci_exp_rxn     => cor_pci_exp_txn,
+      pci_exp_txn     => cor_pci_exp_rxn
+    );
 
   u1 : ddr3ram
     generic map (
@@ -296,7 +324,7 @@ begin
       dqsn   => ddr3_dqs_n,
       doload => led(3)
       );
-  
+
   address(0) <= '0';
   prom0 : for i in 0 to 1 generate
       sr0 : sram generic map (index => i+4, abits => 24, fname => promfile)
