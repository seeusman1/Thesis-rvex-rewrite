%& -shell-escape
\documentclass[11pt,twoside]{ce}
\nonstopmode
%\usepackage{geometry} \geometry{a4paper}
\usepackage[T1]{fontenc}
\usepackage[scaled=0.85]{beramono}
\usepackage{graphicx}
\usepackage{float}
\usepackage{wrapfig}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{color}
\usepackage{tikz}
\usepackage{tabto}
\usepackage[hidelinks]{hyperref}
\usepackage{listings}
\usepackage{import}
\usepackage{todonotes}
\usepackage{amssymb}
\usepackage{pifont}
\usepackage{placeins}
\usepackage{fancyhdr}


%===============================================================================
% Hyperref stuff
%===============================================================================

% Also list subsubsections in the PDF contents.
\hypersetup{bookmarksdepth=4}


%===============================================================================
% Code listings
%===============================================================================

\input{generated/vexasm.generated}
\lstdefinelanguage{nothing}{sensitive=false}

\lstset{language=VHDL}
\definecolor{codeBackgroundColor}{rgb}{0.97,0.98,0.99}
\definecolor{codeBorderColor}    {rgb}{0.90,0.933,0.966}
\definecolor{codeCommentColor}   {rgb}{0.0,0.6,0.0}
\definecolor{codeNumberColor}    {rgb}{0.75,0.8,0.85}
\definecolor{codeKeywordColor}   {rgb}{0.0,0.0,1.0}
\definecolor{codeStringColor}    {rgb}{0.5,0.5,0.5}
\definecolor{codeInlineColor}    {rgb}{0.2,0.2,0.2}
\lstset{ %
  basicstyle=\scriptsize\ttfamily,
  frame=single,
  rulecolor=\color{codeBorderColor},
  backgroundcolor=\color{codeBackgroundColor},
  commentstyle=\color{codeCommentColor},
  keywordstyle=\color{codeKeywordColor},
  numberstyle=\color{codeNumberColor},
  stringstyle=\color{codeStringColor},
  numbers=left,
  numbersep=5pt,
  stepnumber=1,
  tabsize=2
}


%===============================================================================
% Custom LaTeX commands
%===============================================================================

% rho-VEX style command.
\newcommand{\rvex}{\texorpdfstring{$\rho$}{r}-VEX}

% Inline code command.
\newcommand{\codenodetok}[1]{{\color{codeInlineColor}\small{\texttt{#1}}}}
\newcommand{\code}[1]{\codenodetok{\detokenize{#1}}}

% Code headers.
\newcommand{\codehead}[1]{\noindent\textbf{\footnotesize\texttt{\detokenize{#1}}}}

% Hyperlink commands to the documentation of basic core features.
\newcommand{\creg}[1]{\hyperref[reg:#1]{\code{CR_#1}}}
\newcommand{\insn}[1]{\hyperref[opc:#1]{\code{#1}}}
\newcommand{\trap}[1]{\hyperref[trap:#1]{\code{TRAP_#1}}}
\newcommand{\rvexent}[1]{\hyperlink{entity:#1}{\code{#1}}}

% Magic command which allows lengths to be divided. Thanks, stackoverflow!
\makeatletter
\newcommand*{\DivideLengths}[2]{%
  \strip@pt\dimexpr\number\numexpr\number\dimexpr#1\relax*65536/\number\dimexpr#2\relax\relax sp\relax
}
\makeatother


%===============================================================================
% TOC bullshit due to page numbering
%===============================================================================

\makeatletter
\renewcommand{\@pnumwidth}{2.7em}
\renewcommand{\@tocrmarg}{3.3em}
\makeatother


%===============================================================================
\begin{document}
%===============================================================================


%-------------------------------------------------------------------------------
% Title page
%-------------------------------------------------------------------------------

% \pagenumbering{gobble}
% \begin{titlepage}
% \newcommand{\HRule}{\rule{\linewidth}{0.5mm}}
% \center
% \vspace*{5cm}
% \HRule \\[0.4cm]
% { \huge \bfseries \rvex{} user manual}\\[0.2cm]
% \HRule \\[0.5cm]
% \vskip 1em
% Computer Engineering Laboratory, TU Delft \\[0.4cm]
% \today
% \vfill
% \end{titlepage}
% \setcounter{page}{0}
% \cleardoublepage
% \pagenumbering{arabic}
% \setcounter{page}{1}

% Continue numbering after thesis.
\pagenumbering{arabic}
\setcounter{page}{3}
\renewcommand*{\thepage}{C-\arabic{page}}

% Mimic thesis headers.
\pagestyle{fancy}
\fancyhead[LE,RO]{\thepage}
\fancyhead[RE]{\textit{APPENDIX C. \rvex{} USER MANUAL}}
\fancyhead[LO]{\textit{\leftmark}}
\fancyfoot[L,C,R]{}
\setlength{\headheight}{14pt}


%-------------------------------------------------------------------------------
% Table of contents
%-------------------------------------------------------------------------------

\tableofcontents


%-------------------------------------------------------------------------------
% Content
%-------------------------------------------------------------------------------


\let\actualsection\section
\let\actualsubsection\subsection
\let\actualsubsubsection\subsubsection
\let\actualparagraph\paragraph

\let\subsection\actualsection
\let\subsubsection\actualsubsection
\let\paragraph\actualsubsubsection

\chapter{Introduction}
\todo[inline]{Introduction needs to be written}

\chapter{Overview of the \rvex{} processor}
\subimport{2-core-ug/1-intro/}{core-ug-intro.tex}

\chapter{Instruction set architecture}
\subimport{2-core-ug/2-isa/}{core-ug-isa.tex}

\chapter{Control registers}
\subimport{2-core-ug/3-creg/}{core-ug-creg.tex}

\chapter{Traps and interrupts}
\subimport{2-core-ug/4-traps/}{core-ug-traps.tex}

\chapter{Reconfiguration and sleeping}
\subimport{2-core-ug/5-reconf/}{core-ug-reconf.tex}

\chapter{Debugging with rvd}
\todo[inline]{Debugging section needs to be written}

\chapter{Design-time configuration}
\subimport{2-core-ug/6-cfg/}{core-ug-cfg.tex}

\chapter{Instantiation}
\subimport{2-core-ug/7-inst/}{core-ug-inst.tex}


\let\subsection\actualsubsection
\let\subsubsection\actualsubsubsection
\let\paragraph\actualparagraph

\chapter{VHDL source organization}
\todo[inline]{Introduction of source organization chapter}

\section{\rvex{} core}
\newcommand{\coreoverviewintro}{\relax}
\subimport{3-core-int/1-overview/}{core-int-overview.tex}

\section{Cache}
\todo[inline]{Cache file organization}

\section{Complete systems}
\todo[inline]{System file organization}

\section{Miscellaneous}
\todo[inline]{Misc file organization}

\section{Code style}
\subimport{3-core-int/1-overview/}{core-int-overview-style.tex}


%-------------------------------------------------------------------------------
% Bibliography
%-------------------------------------------------------------------------------

\bibliographystyle{ieeetr}
\bibliography{bib}
\addcontentsline{toc}{chapter}{Bibliography}

%===============================================================================
\end{document}
%===============================================================================
